<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="csrf-token" content="{{ csrf_token() }}">
    <title>Restaurant Admin</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <link rel="stylesheet" href="https://cdn.datatables.net/1.11.5/css/jquery.dataTables.min.css">
    <style>
        :root {
            --primary-color: #4e73df;
            --secondary-color: #f8f9fc;
            --accent-color: #dddfeb;
            --text-color: #858796;
            --dark-text: #5a5c69;
            --white: #fff;
            --sidebar-width: 250px;
            --sidebar-collapsed-width: 80px;
            --transition-speed: 0.3s;
            --success-color: #1cc88a;
            --danger-color: #e74a3b;
            --warning-color: #f6c23e;
            --info-color: #36b9cc;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        body {
            background-color: var(--secondary-color);
            color: var(--dark-text);
        }

        .wrapper {
            display: flex;
            min-height: 100vh;
        }

        /* Sidebar Styles */
        .sidebar {
            width: var(--sidebar-width);
            background-color: var(--white);
            box-shadow: 0 0.15rem 1.75rem 0 rgba(58, 59, 69, 0.15);
            transition: all var(--transition-speed) ease;
            height: 100vh;
            position: fixed;
            z-index: 100;
        }

        .sidebar.collapsed {
            width: var(--sidebar-collapsed-width);
        }

        .sidebar-header {
            height: 70px;
            display: flex;
            align-items: center;
            justify-content: center;
            background-color: var(--primary-color);
            color: white;
            font-weight: bold;
            font-size: 1.2rem;
        }

        .sidebar-menu {
            padding: 20px 0;
        }

        .sidebar-menu h4 {
            padding: 0 20px;
            margin-bottom: 10px;
            font-size: 0.8rem;
            font-weight: 800;
            color: var(--text-color);
            text-transform: uppercase;
        }

        .sidebar-menu ul {
            list-style: none;
        }

        .sidebar-menu li {
            position: relative;
        }

        .sidebar-menu a {
            display: flex;
            align-items: center;
            padding: 12px 20px;
            color: var(--dark-text);
            text-decoration: none;
            transition: all 0.3s;
        }

        .sidebar-menu a:hover {
            background-color: var(--secondary-color);
            color: var(--primary-color);
        }

        .sidebar-menu a.active {
            color: var(--primary-color);
            font-weight: 600;
        }

        .sidebar-menu i {
            margin-right: 10px;
            width: 20px;
            text-align: center;
        }

        .sidebar.collapsed .sidebar-header h3 {
            display: none;
        }

        .sidebar.collapsed .sidebar-menu h4,
        .sidebar.collapsed .sidebar-menu a span {
            display: none;
        }

        .sidebar.collapsed .sidebar-menu a {
            justify-content: center;
            padding: 12px 0;
        }

        .sidebar.collapsed .sidebar-menu i {
            margin-right: 0;
            font-size: 1.2rem;
        }

        /* Main Content Styles */
        .main-content {
            flex: 1;
            margin-left: var(--sidebar-width);
            transition: margin-left var(--transition-speed) ease;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
        }

        .main-content.collapsed {
            margin-left: var(--sidebar-collapsed-width);
        }

        .topbar {
            height: 70px;
            background-color: #fff;
            box-shadow: 0 0.15rem 1.75rem 0 rgba(58, 59, 69, 0.15);
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 0 20px;
            position: sticky;
            top: 0;
            z-index: 99;
        }

        .toggle-btn {
            background: none;
            border: none;
            color: var(--dark-text);
            font-size: 1.5rem;
            cursor: pointer;
        }

        .user-info {
            display: flex;
            align-items: center;
        }

        .user-info img {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            margin-right: 10px;
        }

        .content {
            padding: 20px;
            flex: 1;
        }

        .page-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .page-header h1 {
            font-size: 1.8rem;
            color: var(--dark-text);
        }

        .breadcrumb {
            display: flex;
            list-style: none;
        }

        .breadcrumb li {
            margin-right: 10px;
            color: var(--text-color);
        }

        .breadcrumb li:not(:last-child)::after {
            content: '/';
            margin-left: 10px;
        }

        .breadcrumb li a {
            color: var(--primary-color);
            text-decoration: none;
        }

        /* Dashboard Cards */
        .dashboard-cards {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .card {
            background-color: #fff;
            border-radius: 5px;
            box-shadow: 0 0.15rem 1.75rem 0 rgba(58, 59, 69, 0.1);
            padding: 20px;
            transition: transform 0.3s;
        }

        .card:hover {
            transform: translateY(-5px);
        }

        .card-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
            padding-bottom: 10px;
            border-bottom: 1px solid var(--accent-color);
        }

        .card-header h3 {
            font-size: 1rem;
            color: var(--dark-text);
        }

        .card-body {
            margin-bottom: 15px;
        }

        .card-footer {
            text-align: right;
        }

        .card-footer a {
            color: var(--primary-color);
            text-decoration: none;
            font-size: 0.9rem;
            font-weight: 600;
        }

        .card-icon {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
        }

        .bg-primary {
            background-color: var(--primary-color);
        }

        .bg-success {
            background-color: var(--success-color);
        }

        .bg-warning {
            background-color: var(--warning-color);
        }

        .bg-info {
            background-color: var(--info-color);
        }

        .bg-danger {
            background-color: var(--danger-color);
        }

        /* Statistics */

        #report-period {
            margin-bottom: 15px;
        }

        #start-date-col, #end-date-col {
            transition: all 0.3s ease;
        }

        .list-group {
            max-height: 300px;
            overflow-y: auto;
        }

        .list-group-item {
            padding: 0.75rem 1.25rem;
            margin-bottom: -1px;
            background-color: #fff;
            border: 1px solid rgba(0, 0, 0, 0.125);
        }

        .stat-number {
            font-size: 1.8rem;
            font-weight: 700;
            color: var(--dark-text);
            margin-bottom: 0.5rem;
        }

        .stat-label {
            font-size: 0.9rem;
            color: var(--text-color);
            margin-bottom: 1.5rem;
        }

        #sales-chart {
            width: 100%;
            min-height: 300px;
        }

        /* Sections */
        .section {
            background-color: #fff;
            border-radius: 5px;
            box-shadow: 0 0.15rem 1.75rem 0 rgba(58, 59, 69, 0.1);
            padding: 20px;
            margin-bottom: 30px;
        }

        .section-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 1px solid var(--accent-color);
        }

        .section-header h2 {
            font-size: 1.3rem;
            color: var(--dark-text);
        }

        /* Footer */
        .footer {
            background-color: #fff;
            padding: 15px 20px;
            text-align: center;
            font-size: 0.9rem;
            color: var(--text-color);
            box-shadow: 0 -0.15rem 1.75rem 0 rgba(58, 59, 69, 0.1);
        }

        /* Page Content */
        .page-content {
            display: none;
        }

        .page-content.active {
            display: block;
        }

        /* Form Styles */
        .form-group {
            margin-bottom: 15px;
        }

        .form-group label {
            display: block;
            margin-bottom: 5px;
            font-weight: 600;
            color: var(--dark-text);
        }

        .form-control {
            width: 100%;
            padding: 10px;
            border: 1px solid var(--accent-color);
            border-radius: 4px;
            font-size: 14px;
        }

        .form-control:focus {
            outline: none;
            border-color: var(--primary-color);
            box-shadow: 0 0 0 0.2rem rgba(78, 115, 223, 0.25);
        }

        .btn {
            padding: 10px 15px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s;
        }

        .btn-primary {
            background-color: var(--primary-color);
            color: white;
        }

        .btn-primary:hover {
            background-color: #2e59d9;
        }

        .btn-success {
            background-color: var(--success-color);
            color: white;
        }

        .btn-success:hover {
            background-color: #17a673;
        }

        .btn-danger {
            background-color: var(--danger-color);
            color: white;
        }

        .btn-danger:hover {
            background-color: #be2617;
        }

        .btn-warning {
            background-color: var(--warning-color);
            color: white;
        }

        .btn-warning:hover {
            background-color: #dda20a;
        }

        .btn-info {
            background-color: var(--info-color);
            color: white;
        }

        .btn-info:hover {
            background-color: #2c9faf;
        }

        .btn-sm {
            padding: 5px 10px;
            font-size: 12px;
        }

        .text-success {
            color: var(--success-color);
        }

        .text-danger {
            color: var(--danger-color);
        }

        .text-warning {
            color: var(--warning-color);
        }

        .text-info {
            color: var(--info-color);
        }

        /* Table Styles */
        .table-responsive {
            overflow-x: auto;
        }

        .table {
            width: 100%;
            border-collapse: collapse;
            margin-bottom: 20px;
        }

        .table th, .table td {
            padding: 12px 15px;
            text-align: left;
            border-bottom: 1px solid var(--accent-color);
        }

        .table th {
            background-color: var(--secondary-color);
            font-weight: 600;
            color: var(--dark-text);
        }

        .table tr:hover {
            background-color: rgba(78, 115, 223, 0.05);
        }

        .badge {
            display: inline-block;
            padding: 5px 10px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 600;
        }

        .badge-primary {
            background-color: rgba(78, 115, 223, 0.1);
            color: var(--primary-color);
        }

        .badge-success {
            background-color: rgba(28, 200, 138, 0.1);
            color: var(--success-color);
        }

        .badge-warning {
            background-color: rgba(246, 194, 62, 0.1);
            color: var(--warning-color);
        }

        .badge-danger {
            background-color: rgba(231, 74, 59, 0.1);
            color: var(--danger-color);
        }

        .badge-info {
            background-color: rgba(54, 185, 204, 0.1);
            color: var(--info-color);
        }

        /* Modal Styles */
        .modal {
            display: none;
            position: fixed;
            z-index: 1050;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            overflow: hidden;
            outline: 0;
            background-color: rgba(0, 0, 0, 0.5);
        }

        .modal-dialog {
            max-width: 600px;
            max-height: 90vh; /* Limits modal height to 90% of viewport */
            overflow-y: auto; /* Makes the modal scrollable */
            margin: 30px auto;
            position: relative;
            width: auto;
        }

        .modal-content {
            position: relative;
            display: flex;
            flex-direction: column;
            width: 100%;
            max-height: 90vh; /* Ensures content respects the modal height */
            background-color: #fff;
            border-radius: 5px;
            box-shadow: 0 0.5rem 1rem rgba(0, 0, 0, 0.15);
            outline: 0;
        }

        .modal-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 15px 20px;
            border-bottom: 1px solid var(--accent-color);
        }

        .modal-header h5 {
            margin: 0;
            font-size: 1.25rem;
        }

        .modal-body {
            position: relative;
            flex: 1 1 auto;
            padding: 20px;
            overflow-y: auto; /* Makes just the body scrollable if needed */
            max-height: calc(90vh - 150px); /* Accounts for header/footer height */
        }

        .modal-footer {
            display: flex;
            align-items: center;
            justify-content: flex-end;
            padding: 15px 20px;
            border-top: 1px solid var(--accent-color);
        }

        .close {
            float: right;
            font-size: 1.5rem;
            font-weight: 700;
            line-height: 1;
            color: #000;
            text-shadow: 0 1px 0 #fff;
            opacity: 0.5;
            background: none;
            border: none;
            cursor: pointer;
        }

        .close:hover {
            opacity: 0.75;
        }

        /* Alert Styles */
        .alert {
            padding: 15px;
            margin-bottom: 20px;
            border: 1px solid transparent;
            border-radius: 4px;
        }

        .alert-success {
            color: #155724;
            background-color: #d4edda;
            border-color: #c3e6cb;
        }

        .alert-danger {
            color: #721c24;
            background-color: #f8d7da;
            border-color: #f5c6cb;
        }

        /* Tabs */
        .nav-tabs {
            border-bottom: 1px solid var(--accent-color);
            margin-bottom: 20px;
        }

        .nav-tabs .nav-item {
            margin-bottom: -1px;
        }

        .nav-tabs .nav-link {
            padding: 10px 15px;
            border: 1px solid transparent;
            border-top-left-radius: 4px;
            border-top-right-radius: 4px;
            color: var(--dark-text);
            text-decoration: none;
        }

        .nav-tabs .nav-link:hover {
            border-color: var(--accent-color);
        }

        .nav-tabs .nav-link.active {
            color: var(--primary-color);
            background-color: #fff;
            border-color: var(--accent-color) var(--accent-color) #fff;
        }

        .tab-content {
            padding: 15px 0;
        }

        /* Section Tabs */
        .section-tabs {
            display: flex;
            border-bottom: 1px solid var(--accent-color);
            margin-bottom: 20px;
        }

        .section-tab {
            padding: 10px 15px;
            cursor: pointer;
            border: 1px solid transparent;
            border-bottom: none;
            margin-right: 5px;
            border-radius: 4px 4px 0 0;
            color: var(--dark-text);
            background-color: var(--secondary-color);
        }

        .section-tab.active {
            background-color: #fff;
            border-color: var(--accent-color);
            color: var(--primary-color);
            font-weight: 600;
        }

        .section-tab:hover:not(.active) {
            background-color: rgba(78, 115, 223, 0.1);
        }

        /* Filters */
        .reservation-filters {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .reservation-filters .form-control {
            height: 38px;
            padding: 8px 12px;
        }

        .reservation-search {
            margin-left: auto;
            width: 250px;
        }

        /* Responsive */
        @media (max-width: 768px) {
            .sidebar {
                width: var(--sidebar-collapsed-width);
            }
            .sidebar-header h3,
            .sidebar-menu h4,
            .sidebar-menu a span {
                display: none;
            }
            .sidebar-menu a {
                justify-content: center;
                padding: 12px 0;
            }
            .sidebar-menu i {
                margin-right: 0;
                font-size: 1.2rem;
            }
            .main-content {
                margin-left: var(--sidebar-collapsed-width);
            }
            
            .dashboard-cards {
                grid-template-columns: 1fr;
            }
            
            .page-header {
                flex-direction: column;
                align-items: flex-start;
            }
            
            .breadcrumb {
                margin-top: 10px;
            }

            .loading-overlay {
                position: fixed;
                top: 0;
                left: 0;
                width: 100%;
                height: 100%;
                background: rgba(255, 255, 255, 0.8);
                display: flex;
                justify-content: center;
                align-items: center;
                z-index: 9999;
            }

            .loading-spinner {
                font-size: 3rem;
                color: var(--primary-color);
            }

            #report-period, #report-start-date, #report-end-date {
                margin-bottom: 15px;
            }
        }
    </style>
</head>
<body>
    <div class="wrapper">
        <!-- Sidebar -->
        <aside class="sidebar" id="sidebar">
            <div class="sidebar-header">
                <h3>Restaurant Admin</h3>
            </div>
            <div class="sidebar-menu">
                <h4>Dashboard</h4>
                <ul>
                    <li><a href="/admin/dashboard" class="active" data-page="dashboard"><i class="fas fa-fw fa-tachometer-alt"></i> <span>Dashboard</span></a></li>
                    <li><a href="/admin/users" data-page="users"><i class="fas fa-fw fa-users"></i> <span>Users</span></a></li>
                    <li><a href="/admin/groups" data-page="groups"><i class="fas fa-fw fa-layer-group"></i> <span>Groups</span></a></li>
                    <li><a href="/admin/stores" data-page="stores"><i class="fas fa-fw fa-store"></i> <span>Stores</span></a></li>
                    <li><a href="/admin/tables" data-page="tables"><i class="fas fa-fw fa-chair"></i> <span>Tables</span></a></li>
                    <li><a href="/admin/category" data-page="category"><i class="fas fa-fw fa-list"></i> <span>Category</span></a></li>
                    <li><a href="/admin/products" data-page="products"><i class="fas fa-fw fa-box-open"></i> <span>Products</span></a></li>
                    <li><a href="/admin/orders" data-page="orders"><i class="fas fa-fw fa-shopping-cart"></i> <span>Orders</span></a></li>
                    <li><a href="/admin/online-orders" data-page="online-orders"><i class="fas fa-fw fa-shopping-bag"></i> <span>Online Orders</span></a></li>
                    <li><a href="/admin/reports" data-page="reports"><i class="fas fa-fw fa-chart-bar"></i> <span>Reports</span></a></li>
                    <li><a href="/admin/company-info" data-page="company-info"><i class="fas fa-fw fa-info-circle"></i> <span>Company info</span></a></li>
                    <li><a href="/admin/profile" data-page="profile"><i class="fas fa-fw fa-user"></i> <span>Profile</span></a></li>
                    <li><a href="/admin/setting" data-page="setting"><i class="fas fa-fw fa-cog"></i> <span>Setting</span></a></li>
                    <li><a href="/logout" data-page="logout"><i class="fas fa-fw fa-sign-out-alt"></i> <span>Logout</span></a></li>
                </ul>
            </div>
        </aside>

        <!-- Main Content -->
        <div class="main-content" id="main-content">
            <!-- Topbar -->
            <nav class="topbar">
                <button class="toggle-btn" id="toggle-btn">
                    <i class="fas fa-bars"></i>
                </button>
                <div class="user-info">
                    <img id="user-avatar" src="../images/placeholder.png" alt="User Avatar">
                    <span id="username-display">Admin</span>
                </div>
            </nav>

            <!-- Content -->
            <div class="content">
                <!-- Dashboard Page -->
                <div class="page-content active" id="dashboard-page">
                    <div class="page-header">
                        <h1>Dashboard</h1>
                        <ul class="breadcrumb">
                            <li><a href="/admin/dashboard">Home</a></li>
                            <li>Dashboard</li>
                        </ul>
                    </div>

                    <div class="dashboard-cards" id="dashboard-stats">
                        <div class="card">
                            <div class="card-header">
                                <h3>Control panel</h3>
                            </div>
                            <div class="card-body">
                                <p>Welcome to the restaurant admin panel</p>
                            </div>
                        </div>

                        <div class="card">
                            <div class="card-header">
                                <h3>Products</h3>
                                <div class="card-icon bg-primary">
                                    <i class="fas fa-box-open"></i>
                                </div>
                            </div>
                            <div class="card-body">
                                <div class="stat-number" id="total-products">0</div>
                                <div class="stat-label">Total Products</div>
                            </div>
                            <div class="card-footer">
                                <a href="/admin/products">More info <i class="fas fa-smile"></i></a>
                            </div>
                        </div>

                        <div class="card">
                            <div class="card-header">
                                <h3>Paid Orders</h3>
                                <div class="card-icon bg-success">
                                    <i class="fas fa-check-circle"></i>
                                </div>
                            </div>
                            <div class="card-body">
                                <div class="stat-number" id="paid-orders">0</div>
                                <div class="stat-label">Restaurant Paid</div>
                                <div class="stat-number" id="paid-online-orders">0</div>
                                <div class="stat-label">Online Paid (Completed)</div>
                            </div>
                            <div class="card-footer">
                                <a href="/admin/orders?status=paid" class="mr-3">Restaurant Orders</a>
                                <a href="/admin/online-orders?status=completed">Online Orders</a>
                            </div>
                        </div>

                        <div class="card">
                            <div class="card-header">
                                <h3>Unpaid Orders</h3>
                                <div class="card-icon bg-warning">
                                    <i class="fas fa-exclamation-circle"></i>
                                </div>
                            </div>
                            <div class="card-body">
                                <div class="stat-number" id="unpaid-orders">0</div>
                                <div class="stat-label">Restaurant Unpaid</div>
                                <div class="stat-number" id="unpaid-online-orders">0</div>
                                <div class="stat-label">Online Unpaid (Pending/Processing)</div>
                            </div>
                            <div class="card-footer">
                                <a href="/admin/orders?status=unpaid" class="mr-3">Restaurant Orders</a>
                                <a href="/admin/online-orders?status=pending,processing">Online Orders</a>
                            </div>
                        </div>

                        <div class="card">
                            <div class="card-header">
                                <h3>Available Tables</h3>
                                <div class="card-icon bg-info">
                                    <i class="fas fa-chair"></i>
                                </div>
                            </div>
                            <div class="card-body">
                                <div class="stat-number" id="available-tables">0</div>
                                <div class="stat-label">Available Tables</div>
                            </div>
                            <div class="card-footer">
                                <a href="/admin/tables">More info <i class="fas fa-smile"></i></a>
                            </div>
                        </div>
                    </div>

                    <div class="section">
                        <div class="section-header">
                            <h2>System Users</h2>
                        </div>
                        <div class="card">
                            <div class="card-body">
                                <p>User management system</p>
                            </div>
                            <div class="card-footer">
                                <a href="/admin/users">More info <i class="fas fa-smile"></i></a>
                            </div>
                        </div>
                    </div>

                    <!-- Update the Orders section to show both types -->
                    <div class="card">
                        <div class="card-header">
                            <h3>Paid Orders</h3>
                            <div class="card-icon bg-success">
                                <i class="fas fa-check-circle"></i>
                            </div>
                        </div>
                        <div class="card-body">
                            <div class="stat-number" id="paid-orders">0</div>
                            <div class="stat-label">Restaurant Paid</div>
                            <div class="stat-number" id="paid-online-orders">0</div>
                            <div class="stat-label">Online Paid</div>
                        </div>
                        <div class="card-footer">
                            <a href="/admin/orders?payment_status=paid" class="mr-3">Restaurant Orders</a>
                            <a href="/admin/online-orders?payment_status=paid">Online Orders</a>
                        </div>
                    </div>

                    <div class="card">
                        <div class="card-header">
                            <h3>Unpaid Orders</h3>
                            <div class="card-icon bg-warning">
                                <i class="fas fa-exclamation-circle"></i>
                            </div>
                        </div>
                        <div class="card-body">
                            <div class="stat-number" id="unpaid-orders">0</div>
                            <div class="stat-label">Restaurant Unpaid</div>
                            <div class="stat-number" id="unpaid-online-orders">0</div>
                            <div class="stat-label">Online Unpaid</div>
                        </div>
                        <div class="card-footer">
                            <a href="/admin/orders?payment_status=unpaid" class="mr-3">Restaurant Orders</a>
                            <a href="/admin/online-orders?payment_status=unpaid">Online Orders</a>
                        </div>
                    </div>

                    <div class="section">
                        <div class="section-header">
                            <h2>Available Stores</h2>
                        </div>
                        <div class="card">
                            <div class="card-body">
                                <div class="stat-number" id="total-stores">0</div>
                                <div class="stat-label">Available Stores</div>
                                <div class="stat-number" id="total-earnings">$0.00</div>
                                <div class="stat-label">Total Earnings</div>
                            </div>
                            <div class="card-footer">
                                <a href="/admin/stores">More info <i class="fas fa-smile"></i></a>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Users Page -->
                <div id="users-content" class="page-content">
                    <div class="page-header">
                        <h1>Users</h1>
                        <ul class="breadcrumb">
                            <li><a href="/admin/dashboard">Home</a></li>
                            <li>Users</li>
                        </ul>
                    </div>
                    
                    <div id="users-alert" class="alert" style="display: none;"></div>
                    
                    <div class="card">
                        <div class="card-header">
                            <h3>User Management</h3>
                            <div class="card-icon"><i class="fas fa-users"></i></div>
                        </div>
                        <div class="card-body">
                            <button class="btn btn-primary mb-3" id="add-user-btn">
                                <i class="fas fa-plus"></i> Add New User
                            </button>
                            
                            <div class="table-responsive">
                                <table class="table" id="users-table">
                                    <thead>
                                        <tr>
                                            <th>ID</th>
                                            <th>Username</th>
                                            <th>Email</th>
                                            <th>Role</th>
                                            <th>Status</th>
                                            <th>Last Login</th>
                                            <th>Actions</th>
                                        </tr>
                                    </thead>
                                    <tbody id="users-table-body">
                                        <!-- Users will be loaded here -->
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Groups Page -->
                <div id="groups-content" class="page-content">
                    <div class="page-header">
                        <h1>Groups</h1>
                        <ul class="breadcrumb">
                            <li><a href="/admin/dashboard">Home</a></li>
                            <li>Groups</li>
                        </ul>
                    </div>
                    
                    <div id="groups-alert" class="alert" style="display: none;"></div>
                    
                    <div class="card">
                        <div class="card-header">
                            <h3>Group Management</h3>
                            <div class="card-icon"><i class="fas fa-layer-group"></i></div>
                        </div>
                        <div class="card-body">
                            <button class="btn btn-primary mb-3" id="add-group-btn">
                                <i class="fas fa-plus"></i> Add New Group
                            </button>
                            
                            <div class="table-responsive">
                                <table class="table" id="groups-table">
                                    <thead>
                                        <tr>
                                            <th>ID</th>
                                            <th>Name</th>
                                            <th>Description</th>
                                            <th>Created At</th>
                                            <th>Actions</th>
                                        </tr>
                                    </thead>
                                    <tbody id="groups-table-body">
                                        <!-- Groups will be loaded here -->
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Stores Page -->
                <div id="stores-content" class="page-content">
                    <div class="page-header">
                        <h1>Stores</h1>
                        <ul class="breadcrumb">
                            <li><a href="/admin/dashboard">Home</a></li>
                            <li>Stores</li>
                        </ul>
                    </div>
                    
                    <div id="stores-alert" class="alert" style="display: none;"></div>
                    
                    <div class="card">
                        <div class="card-header">
                            <h3>Store Management</h3>
                            <div class="card-icon"><i class="fas fa-store"></i></div>
                        </div>
                        <div class="card-body">
                            <button class="btn btn-primary mb-3" id="add-store-btn">
                                <i class="fas fa-plus"></i> Add New Store
                            </button>
                            
                            <div class="table-responsive">
                                <table class="table" id="stores-table">
                                    <thead>
                                        <tr>
                                            <th>ID</th>
                                            <th>Name</th>
                                            <th>Address</th>
                                            <th>Phone</th>
                                            <th>Status</th>
                                            <th>Actions</th>
                                        </tr>
                                    </thead>
                                    <tbody id="stores-table-body">
                                        <!-- Stores will be loaded here -->
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Tables Page -->
                <div id="tables-content" class="page-content">
                    <div class="page-header">
                        <h1>Tables</h1>
                        <ul class="breadcrumb">
                            <li><a href="/admin/dashboard">Home</a></li>
                            <li>Tables</li>
                        </ul>
                    </div>
                    
                    <div id="tables-alert" class="alert" style="display: none;"></div>
                    
                    <div class="card">
                        <div class="card-header">
                            <h3>Table Management</h3>
                            <div class="card-icon"><i class="fas fa-chair"></i></div>
                        </div>
                        <div class="card-body">
                            <button class="btn btn-primary mb-3" id="add-table-btn">
                                <i class="fas fa-plus"></i> Add New Table
                            </button>
                            
                            <div class="table-responsive">
                                <table class="table" id="tables-table">
                                    <thead>
                                        <tr>
                                            <th>ID</th>
                                            <th>Store</th>
                                            <th>Table Number</th>
                                            <th>Capacity</th>
                                            <th>Status</th>
                                            <th>Actions</th>
                                        </tr>
                                    </thead>
                                    <tbody id="tables-table-body">
                                        <!-- Tables will be loaded here -->
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Category Page -->
                <div id="category-content" class="page-content">
                    <div class="page-header">
                        <h1>Category</h1>
                        <ul class="breadcrumb">
                            <li><a href="/admin/dashboard">Home</a></li>
                            <li>Category</li>
                        </ul>
                    </div>
                    
                    <div id="category-alert" class="alert" style="display: none;"></div>
                    
                    <div class="card">
                        <div class="card-header">
                            <h3>Category Management</h3>
                            <div class="card-icon"><i class="fas fa-list"></i></div>
                        </div>
                        <div class="card-body">
                            <button class="btn btn-primary mb-3" id="add-category-btn">
                                <i class="fas fa-plus"></i> Add New Category
                            </button>
                            
                            <div class="table-responsive">
                                <table class="table" id="categories-table">
                                    <thead>
                                        <tr>
                                            <th>ID</th>
                                            <th>Name</th>
                                            <th>Description</th>
                                            <th>Status</th>
                                            <th>Actions</th>
                                        </tr>
                                    </thead>
                                    <tbody id="categories-table-body">
                                        <!-- Categories will be loaded here -->
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Products Page -->
                <div id="products-content" class="page-content">
                    <div class="page-header">
                        <h1>Products</h1>
                        <ul class="breadcrumb">
                            <li><a href="/admin/dashboard">Home</a></li>
                            <li>Products</li>
                        </ul>
                    </div>
                    
                    <div id="products-alert" class="alert" style="display: none;"></div>
                    
                    <div class="card">
                        <div class="card-header">
                            <h3>Product Management</h3>
                            <div class="card-icon"><i class="fas fa-box-open"></i></div>
                        </div>
                        <div class="card-body">
                            <button class="btn btn-primary mb-3" id="add-product-btn">
                                <i class="fas fa-plus"></i> Add New Product
                            </button>
                            
                            <div class="table-responsive">
                                <table class="table" id="products-table">
                                    <thead>
                                        <tr>
                                            <th>ID</th>
                                            <th>Name</th>
                                            <th>Category</th>
                                            <th>Price</th>
                                            <th>Cost</th>
                                            <th>Status</th>
                                            <th>Actions</th>
                                        </tr>
                                    </thead>
                                    <tbody id="products-table-body">
                                        <!-- Products will be loaded here -->
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Orders Page -->
                <div id="orders-content" class="page-content">
                    <div class="page-header">
                        <h1>Orders</h1>
                        <ul class="breadcrumb">
                            <li><a href="/admin/dashboard">Home</a></li>
                            <li>Orders</li>
                        </ul>
                    </div>
                    
                    <div id="orders-alert" class="alert" style="display: none;"></div>
                    
                    <div class="card">
                        <div class="card-header">
                            <h3>Order Management</h3>
                            <div class="card-icon"><i class="fas fa-shopping-cart"></i></div>
                        </div>
                        <div class="card-body">
                            <button class="btn btn-primary mb-3" id="add-order-btn">
                                <i class="fas fa-plus"></i> Add New Order
                            </button>
                            
                            <div class="table-responsive">
                                <table class="table" id="orders-table">
                                    <thead>
                                        <tr>
                                            <th>ID</th>
                                            <th>Table</th>
                                            <th>User</th>
                                            <th>Status</th>
                                            <th>Total Amount</th>
                                            <th>Payment Status</th>
                                            <th>Created At</th>
                                            <th>Actions</th>
                                        </tr>
                                    </thead>
                                    <tbody id="orders-table-body">
                                        <!-- Orders will be loaded here -->
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Online Orders Page -->
                <div id="online-orders-content" class="page-content">
                    <div class="page-header">
                        <h1>Online Orders</h1>
                        <ul class="breadcrumb">
                            <li><a href="/admin/dashboard">Home</a></li>
                            <li>Online Orders</li>
                        </ul>
                    </div>
                    
                    <div id="online-orders-alert" class="alert" style="display: none;"></div>
                    
                    <div class="section-tabs">
                        <div class="section-tab active" data-tab="all">All Orders</div>
                        <div class="section-tab" data-tab="pending">Pending</div>
                        <div class="section-tab" data-tab="processing">Processing</div>
                        <div class="section-tab" data-tab="completed">Completed</div>
                        <div class="section-tab" data-tab="cancelled">Cancelled</div>
                    </div>
                    
                    <div class="card">
                    <div class="card-header">
                        <h3>Online Order Management</h3>
                        <div class="reservation-filters">
                            <input type="date" id="online-orders-date" class="form-control">
                            <button id="apply-online-order-filters-btn" class="btn btn-primary">Apply</button>
                        </div>
                    </div>
                        <div class="card-body">
                            <div class="table-responsive">
                                <table class="table" id="online-orders-table">
                                    <thead>
                                        <tr>
                                            <th>Order #</th>
                                            <th>Customer</th>
                                            <th>Items</th>
                                            <th>Total</th>
                                            <th>Payment</th>
                                            <th>Status</th>
                                            <th>Date</th>
                                            <th>Actions</th>
                                        </tr>
                                    </thead>
                                    <tbody id="online-orders-table-body">
                                        <!-- Online orders will be loaded here -->
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Reports Page -->
                <div id="reports-content" class="page-content">
                    <div class="page-header">
                        <h1>Reports</h1>
                        <ul class="breadcrumb">
                            <li><a href="/admin/dashboard">Home</a></li>
                            <li>Reports</li>
                        </ul>
                    </div>
                    
                    <div class="card">
                        <div class="card-header">
                            <h3>Sales Reports</h3>
                            <div class="card-icon"><i class="fas fa-chart-bar"></i></div>
                        </div>
                        <div class="card-body">
                            <div class="row mb-4">
                                <div class="col-md-3">
                                    <div class="form-group">
                                        <label for="report-period">Period</label>
                                        <select class="form-control" id="report-period">
                                            <option value="daily">Daily</option>
                                            <option value="weekly">Weekly</option>
                                            <option value="monthly">Monthly</option>
                                            <option value="yearly">Yearly</option>
                                            <option value="custom">Custom Date Range</option>
                                        </select>
                                    </div>
                                </div>
                                <div class="col-md-3" id="start-date-col">
                                    <div class="form-group">
                                        <label for="report-start-date">Start Date</label>
                                        <input type="date" class="form-control" id="report-start-date">
                                    </div>
                                </div>
                                <div class="col-md-3" id="end-date-col">
                                    <div class="form-group">
                                        <label for="report-end-date">End Date</label>
                                        <input type="date" class="form-control" id="report-end-date">
                                    </div>
                                </div>
                                <div class="col-md-3 d-flex align-items-end">
                                    <button class="btn btn-primary w-100" id="generate-report-btn">
                                        <i class="fas fa-chart-line"></i> Generate Report
                                    </button>
                                </div>
                            </div>
                            
                            <div class="section-tabs mb-4">
                                <div class="section-tab active" data-report-type="all">All Sales</div>
                                <div class="section-tab" data-report-type="restaurant">Restaurant</div>
                                <div class="section-tab" data-report-type="online">Online</div>
                            </div>
                            
                            <div id="report-results">
                                <div class="row">
                                    <div class="col-md-6">
                                        <div class="card mb-4">
                                            <div class="card-header">
                                                <h4>Sales Summary</h4>
                                                <button class="btn btn-secondary btn-sm" id="generate-pdf-btn" style="display: none;">
                                                    <i class="fas fa-file-pdf"></i> Download PDF
                                                </button>
                                            </div>
                                            <div class="card-body">
                                                <div id="sales-summary">
                                                    <p>Select date range and generate report</p>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="col-md-6">
                                        <div class="card mb-4">
                                            <div class="card-header">
                                                <h4>Top Products</h4>
                                            </div>
                                            <div class="card-body">
                                                <div id="top-products">
                                                    <p>Select date range and generate report</p>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                
                                <div class="row">
                                    <div class="col-md-12">
                                        <div class="card">
                                            <div class="card-header">
                                                <h4>Sales Chart</h4>
                                            </div>
                                            <div class="card-body">
                                                <canvas id="sales-chart" height="300"></canvas>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                
                                <div class="row mt-4">
                                    <div class="col-md-12">
                                        <div class="card">
                                            <div class="card-header">
                                                <h4>Order Types Breakdown</h4>
                                            </div>
                                            <div class="card-body">
                                                <canvas id="order-types-chart" height="200"></canvas>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

            <!-- Company Info Page -->
            <div id="company-info-content" class="page-content">
                <div class="page-header">
                    <h1>Company Info</h1>
                    <ul class="breadcrumb">
                        <li><a href="/admin/dashboard">Home</a></li>
                        <li>Company Info</li>
                    </ul>
                </div>
                
                <div id="company-info-alert" class="alert" style="display: none;"></div>
                
                <div class="card">
                    <div class="card-header">
                        <h3>Company Information</h3>
                        <div class="card-icon"><i class="fas fa-info-circle"></i></div>
                    </div>
                    <div class="card-body">
                        <form id="company-info-form">
                            <div class="form-group">
                                <label for="company-name">Company Name</label>
                                <input type="text" class="form-control" id="company-name" required>
                            </div>
                            <div class="form-group">
                                <label for="company-address">Address</label>
                                <textarea class="form-control" id="company-address" rows="3"></textarea>
                            </div>
                            <div class="form-group">
                                <label for="company-phone">Phone</label>
                                <input type="text" class="form-control" id="company-phone">
                            </div>
                            <div class="form-group">
                                <label for="company-email">Email</label>
                                <input type="email" class="form-control" id="company-email">
                            </div>
                            <div class="form-group">
                                <label for="company-opening-hours">Opening Hours</label>
                                <textarea class="form-control" id="company-opening-hours" rows="3"></textarea>
                            </div>
                            <button type="submit" class="btn btn-primary">Save Changes</button>
                        </form>
                    </div>
                </div>
            </div>

            <!-- Profile Page -->
            <div id="profile-content" class="page-content">
                <div class="page-header">
                    <h1>Profile</h1>
                    <ul class="breadcrumb">
                        <li><a href="/admin/dashboard">Home</a></li>
                        <li>Profile</li>
                    </ul>
                </div>
                
                <div id="profile-alert" class="alert" style="display: none;"></div>
                
                <div class="card">
                    <div class="card-header">
                        <h3>User Profile</h3>
                        <div class="card-icon"><i class="fas fa-user"></i></div>
                    </div>
                    <div class="card-body">
                        <div class="row">
                            <div class="col-md-3 text-center">
                                <img id="profile-image-preview" src="../images/placeholder.png" alt="Profile Image" class="img-thumbnail mb-3" style="width: 150px; height: 150px; object-fit: cover;">
                                <div class="form-group">
                                    <label for="profile-image-url">Image URL</label>
                                    <input type="text" class="form-control" id="profile-image-url" placeholder="Enter image URL">
                                    <small class="form-text text-muted">Paste a direct image URL</small>
                                </div>
                            </div>
                            <div class="col-md-9">
                                <form id="profile-form">
                                    <div class="form-group">
                                        <label for="profile-username">Username</label>
                                        <input type="text" class="form-control" id="profile-username" readonly>
                                    </div>
                                    <div class="form-group">
                                        <label for="profile-email">Email</label>
                                        <input type="email" class="form-control" id="profile-email" required>
                                    </div>
                                    <div class="form-group">
                                        <label for="profile-role">Role</label>
                                        <input type="text" class="form-control" id="profile-role" readonly>
                                    </div>
                                    <div class="form-group">
                                        <label for="profile-current-password">Current Password (leave blank to keep unchanged)</label>
                                        <input type="password" class="form-control" id="profile-current-password">
                                    </div>
                                    <div class="form-group">
                                        <label for="profile-new-password">New Password</label>
                                        <input type="password" class="form-control" id="profile-new-password">
                                    </div>
                                    <div class="form-group">
                                        <label for="profile-confirm-password">Confirm New Password</label>
                                        <input type="password" class="form-control" id="profile-confirm-password">
                                    </div>
                                    <button type="submit" class="btn btn-primary">Update Profile</button>
                                </form>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Setting Page -->
            <div id="setting-content" class="page-content">
                <div class="page-header">
                    <h1>Setting</h1>
                    <ul class="breadcrumb">
                        <li><a href="/admin/dashboard">Home</a></li>
                        <li>Setting</li>
                    </ul>
                </div>
                
                <div id="setting-alert" class="alert" style="display: none;"></div>
                
                <div class="card">
                    <div class="card-header">
                        <h3>System Settings</h3>
                        <div class="card-icon"><i class="fas fa-cog"></i></div>
                    </div>
                    <div class="card-body">
                        <form id="settings-form">
                            <div class="form-group">
                                <label for="setting-currency">Currency</label>
                                <select class="form-control" id="setting-currency">
                                    <option value="$">Dollar ($)</option>
                                    <option value="">Euro ()</option>
                                    <option value="">Pound ()</option>
                                    <option value="">Yen ()</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label for="setting-tax-rate">Tax Rate (%)</label>
                                <input type="number" class="form-control" id="setting-tax-rate" min="0" max="100" step="0.01">
                            </div>
                            <div class="form-group">
                                <label for="setting-timezone">Timezone</label>
                                <select class="form-control" id="setting-timezone">
                                    <option value="UTC">UTC</option>
                                    <option value="EST">Eastern Time (EST)</option>
                                    <option value="PST">Pacific Time (PST)</option>
                                    <option value="CET">Central European Time (CET)</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label for="setting-date-format">Date Format</label>
                                <select class="form-control" id="setting-date-format">
                                    <option value="YYYY-MM-DD">YYYY-MM-DD</option>
                                    <option value="MM/DD/YYYY">MM/DD/YYYY</option>
                                    <option value="DD/MM/YYYY">DD/MM/YYYY</option>
                                </select>
                            </div>
                            <button type="submit" class="btn btn-primary">Save Settings</button>
                        </form>
                    </div>
                </div>
            </div>

            <!-- Logout Page -->
            <div id="logout-content" class="page-content">
                <div class="page-header">
                    <h1>Logout</h1>
                    <ul class="breadcrumb">
                        <li><a href="/admin/dashboard">Home</a></li>
                        <li>Logout</li>
                    </ul>
                </div>
                <div class="card">
                    <div class="card-header">
                        <h3>Logout</h3>
                        <div class="card-icon"><i class="fas fa-sign-out-alt"></i></div>
                    </div>
                    <div class="card-body">
                        <p>You have been logged out successfully.</p>
                        <a href="/" class="btn btn-primary">Login again</a>
                    </div>
                </div>
            </div>
        </div>

        <!-- Footer -->
        <footer class="footer">
             2023 | All rights reserved - Restaurant Management System<br>
            Version 2.0.0
        </footer>
    </div>
</div>

<!-- Modals -->
<!-- User Modal -->
<div class="modal" id="user-modal">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="user-modal-title">Add New User</h5>
                <button type="button" class="close" data-dismiss="modal">&times;</button>
            </div>
            <div class="modal-body">
                <form id="user-form">
                    <input type="hidden" id="user-id">
                    <div class="form-group">
                        <label for="user-username">Username</label>
                        <input type="text" class="form-control" id="user-username" required>
                    </div>
                    <div class="form-group">
                        <label for="user-email">Email</label>
                        <input type="email" class="form-control" id="user-email" required>
                    </div>
                    <div class="form-group">
                        <label for="user-role">Role</label>
                        <select class="form-control" id="user-role" required>
                            <option value="admin">Admin</option>
                            <option value="staff">Staff</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="user-password">Password</label>
                        <input type="password" class="form-control" id="user-password">
                        <small class="text-muted">Leave blank to keep current password</small>
                    </div>
                    <div class="form-group">
                        <label for="user-status">Status</label>
                        <select class="form-control" id="user-status" required>
                            <option value="true">Active</option>
                            <option value="false">Inactive</option>
                        </select>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
                <button type="button" class="btn btn-primary" id="save-user-btn">Save User</button>
            </div>
        </div>
    </div>
</div>

<!-- Group Modal -->
<div class="modal" id="group-modal">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="group-modal-title">Add New Group</h5>
                <button type="button" class="close" data-dismiss="modal">&times;</button>
            </div>
            <div class="modal-body">
                <form id="group-form">
                    <input type="hidden" id="group-id">
                    <div class="form-group">
                        <label for="group-name">Group Name</label>
                        <input type="text" class="form-control" id="group-name" required>
                    </div>
                    <div class="form-group">
                        <label for="group-description">Description</label>
                        <textarea class="form-control" id="group-description" rows="3"></textarea>
                    </div>
                    <div class="form-group">
                        <label>Permissions</label>
                        <div class="permissions-list">
                            <!-- Permissions will be added here dynamically -->
                        </div>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
                <button type="button" class="btn btn-primary" id="save-group-btn">Save Group</button>
            </div>
        </div>
    </div>
</div>

<!-- Store Modal -->
<div class="modal" id="store-modal">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="store-modal-title">Add New Store</h5>
                <button type="button" class="close" data-dismiss="modal">&times;</button>
            </div>
            <div class="modal-body">
                <form id="store-form">
                    <input type="hidden" id="store-id">
                    <div class="form-group">
                        <label for="store-name">Store Name</label>
                        <input type="text" class="form-control" id="store-name" required>
                    </div>
                    <div class="form-group">
                        <label for="store-address">Address</label>
                        <textarea class="form-control" id="store-address" rows="3"></textarea>
                    </div>
                    <div class="form-group">
                        <label for="store-phone">Phone</label>
                        <input type="text" class="form-control" id="store-phone">
                    </div>
                    <div class="form-group">
                        <label for="store-email">Email</label>
                        <input type="email" class="form-control" id="store-email">
                    </div>
                    <!-- Image URL field (like products) -->
                    <div class="form-group">
                        <label for="store-image">Image URL</label>
                        <input type="text" class="form-control" id="store-image">
                        <small class="text-muted">Enter URL of store image</small>
                        <div class="mt-2" id="store-image-preview-container" style="display: none;">
                            <img id="store-image-preview" src="#" alt="Store preview" style="max-width: 100%; max-height: 200px;">
                        </div>
                    </div>
                    <div class="form-group">
                        <label for="store-opening-hours">Opening Hours</label>
                        <textarea class="form-control" id="store-opening-hours" rows="3"></textarea>
                    </div>
                    <div class="form-group">
                        <label for="store-status">Status</label>
                        <select class="form-control" id="store-status" required>
                            <option value="true">Active</option>
                            <option value="false">Inactive</option>
                        </select>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
                <button type="button" class="btn btn-primary" id="save-store-btn">Save Store</button>
            </div>
        </div>
    </div>
</div>

<!-- Table Modal -->
<div class="modal" id="table-modal">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="table-modal-title">Add New Table</h5>
                <button type="button" class="close" data-dismiss="modal">&times;</button>
            </div>
            <div class="modal-body">
                <form id="table-form">
                    <input type="hidden" id="table-id">
                    <div class="form-group">
                        <label for="table-store">Store</label>
                        <select class="form-control" id="table-store" required>
                            <!-- Stores will be loaded here -->
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="table-number">Table Number</label>
                        <input type="text" class="form-control" id="table-number" required>
                    </div>
                    <div class="form-group">
                        <label for="table-capacity">Capacity</label>
                        <input type="number" class="form-control" id="table-capacity" min="1" required>
                    </div>
                    <div class="form-group">
                        <label for="table-status">Status</label>
                        <select class="form-control" id="table-status" required>
                            <option value="available">Available</option>
                            <option value="occupied">Occupied</option>
                            <option value="reserved">Reserved</option>
                            <option value="cleaning">Cleaning</option>
                        </select>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
                <button type="button" class="btn btn-primary" id="save-table-btn">Save Table</button>
            </div>
        </div>
    </div>
</div>

<!-- Category Modal -->
<div class="modal" id="category-modal">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="category-modal-title">Add New Category</h5>
                <button type="button" class="close" data-dismiss="modal">&times;</button>
            </div>
            <div class="modal-body">
                <form id="category-form">
                    <input type="hidden" id="category-id">
                    <div class="form-group">
                        <label for="category-name">Category Name</label>
                        <input type="text" class="form-control" id="category-name" required>
                    </div>
                    <div class="form-group">
                        <label for="category-description">Description</label>
                        <textarea class="form-control" id="category-description" rows="3"></textarea>
                    </div>
                    <div class="form-group">
                        <label for="category-image">Image URL</label>
                        <input type="text" class="form-control" id="category-image">
                    </div>
                    <div class="form-group">
                        <label for="category-status">Status</label>
                        <select class="form-control" id="category-status" required>
                            <option value="true">Active</option>
                            <option value="false">Inactive</option>
                        </select>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
                <button type="button" class="btn btn-primary" id="save-category-btn">Save Category</button>
            </div>
        </div>
    </div>
</div>

<!-- Product Modal -->
<div class="modal" id="product-modal">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="product-modal-title">Add New Product</h5>
                <button type="button" class="close" data-dismiss="modal">&times;</button>
            </div>
            <div class="modal-body">
                <form id="product-form">
                    <input type="hidden" id="product-id">
                    <div class="form-group">
                        <label for="product-name">Product Name</label>
                        <input type="text" class="form-control" id="product-name" required>
                    </div>
                    <div class="form-group">
                        <label for="product-description">Description</label>
                        <textarea class="form-control" id="product-description" rows="3"></textarea>
                    </div>
                    <div class="form-group">
                        <label for="product-category">Category</label>
                        <select class="form-control" id="product-category">
                            <!-- Categories will be loaded here -->
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="product-price">Price</label>
                        <input type="number" class="form-control" id="product-price" min="0" step="0.01" required>
                    </div>
                    <div class="form-group">
                        <label for="product-cost">Cost</label>
                        <input type="number" class="form-control" id="product-cost" min="0" step="0.01">
                    </div>
                    <div class="form-group">
                        <label for="product-image">Image URL</label>
                        <input type="text" class="form-control" id="product-image">
                    </div>
                    <div class="form-group">
                        <label for="product-status">Status</label>
                        <select class="form-control" id="product-status" required>
                            <option value="true">Available</option>
                            <option value="false">Unavailable</option>
                        </select>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
                <button type="button" class="btn btn-primary" id="save-product-btn">Save Product</button>
            </div>
        </div>
    </div>
</div>

<!-- Order Modal -->
<div class="modal" id="order-modal">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="order-modal-title">Add New Order</h5>
                <button type="button" class="close" data-dismiss="modal">&times;</button>
            </div>
            <div class="modal-body">
                <form id="order-form">
                    <input type="hidden" id="order-id">
                    <div class="row">
                        <div class="col-md-6">
                            <div class="form-group">
                                <label for="order-table">Table</label>
                                <select class="form-control" id="order-table" required>
                                    <!-- Tables will be loaded here -->
                                </select>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="form-group">
                                <label for="order-status">Status</label>
                                <select class="form-control" id="order-status" required>
                                    <option value="pending">Pending</option>
                                    <option value="processing">Processing</option>
                                    <option value="completed">Completed</option>
                                    <option value="cancelled">Cancelled</option>
                                </select>
                            </div>
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-md-6">
                            <div class="form-group">
                                <label for="order-payment-method">Payment Method</label>
                                <select class="form-control" id="order-payment-method">
                                    <option value="">Select Payment Method</option>
                                    <option value="cash">Cash</option>
                                    <option value="credit_card">Credit Card</option>
                                    <option value="debit_card">Debit Card</option>
                                    <option value="mobile_payment">Mobile Payment</option>
                                </select>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="form-group">
                                <label for="order-payment-status">Payment Status</label>
                                <select class="form-control" id="order-payment-status" required>
                                    <option value="unpaid">Unpaid</option>
                                    <option value="paid">Paid</option>
                                    <option value="refunded">Refunded</option>
                                </select>
                            </div>
                        </div>
                    </div>
                    <div class="form-group">
                        <label for="order-notes">Notes</label>
                        <textarea class="form-control" id="order-notes" rows="2"></textarea>
                    </div>
                    
                    <div class="card mb-3">
                        <div class="card-header">
                            <h5>Order Items</h5>
                        </div>
                        <div class="card-body">
                            <div class="row mb-3">
                                <div class="col-md-6">
                                    <select class="form-control" id="order-product">
                                        <!-- Products will be loaded here -->
                                    </select>
                                </div>
                                <div class="col-md-2">
                                    <input type="number" class="form-control" id="order-quantity" min="1" value="1">
                                </div>
                                <div class="col-md-4">
                                    <button type="button" class="btn btn-primary" id="add-order-item-btn">Add Item</button>
                                </div>
                            </div>
                            
                            <div class="table-responsive">
                                <table class="table" id="order-items-table">
                                    <thead>
                                        <tr>
                                            <th>Product</th>
                                            <th>Quantity</th>
                                            <th>Price</th>
                                            <th>Total</th>
                                            <th>Actions</th>
                                        </tr>
                                    </thead>
                                    <tbody id="order-items-body">
                                        <!-- Order items will be added here -->
                                    </tbody>
                                    <tfoot>
                                        <tr>
                                            <th colspan="3">Total Amount</th>
                                            <th id="order-total-amount">$0.00</th>
                                            <th></th>
                                        </tr>
                                    </tfoot>
                                </table>
                            </div>
                        </div>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
                <button type="button" class="btn btn-primary" id="save-order-btn">Save Order</button>
            </div>
        </div>
    </div>
</div>

<!-- Delete Confirmation Modal -->
<div class="modal" id="delete-modal">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">Confirm Delete</h5>
                <button type="button" class="close" data-dismiss="modal">&times;</button>
            </div>
            <div class="modal-body">
                <p>Are you sure you want to delete this item?</p>
                <input type="hidden" id="delete-id">
                <input type="hidden" id="delete-type">
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-dismiss="modal">Cancel</button>
                <button type="button" class="btn btn-danger" id="confirm-delete-btn">Delete</button>
            </div>
        </div>
    </div>
</div>

<!-- Scripts -->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script> 
<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script src="https://cdn.datatables.net/1.11.5/js/jquery.dataTables.min.js"></script> 
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script> 
<script>
    // Global variables
    let currentUser = null;
    let salesChart = null;

    // Initialize the application
    $(document).ready(function() {
        // Load current user data
        loadCurrentUser();
        
        // Load dashboard stats
        loadDashboardStats();
        
        // Initialize DataTables with default options
        const dataTableOptions = {
            responsive: true,
            searching: true,
            paging: true,
            ordering: true,
            info: true,
            autoWidth: false,
            destroy: true // Allows reinitialization
        };
        
        // Set up event listeners
        setupEventListeners();
        
        // Show the appropriate page based on URL
        showPageFromURL();

        // Initialize report dates
        initReportDates();
        
        // Period selector change handler
        $('#report-period').change(function() {
            const period = $(this).val();
            updateDateRange(period);
            toggleDateInputs(period);
            
            // Only auto-generate if not custom period
            if (period !== 'custom') {
                generateReport();
            }
        });
        
        // Date input change handler
        $('#report-start-date, #report-end-date').change(function() {
            if ($('#report-period').val() === 'custom') {
                generateReport();
            }
        });
        
        // Generate initial report
        generateReport();
    });
    
    // Set up CSRF token for AJAX requests
    $.ajaxSetup({
        beforeSend: function(xhr, settings) {
            if (!/^(GET|HEAD|OPTIONS|TRACE)$/i.test(settings.type)) {
                xhr.setRequestHeader("X-CSRFToken", $('meta[name="csrf-token"]').attr('content'));
            }
        }
    });

    // Enhanced error handler
    function handleAjaxError(xhr, defaultMessage = 'Operation failed') {
        let message = defaultMessage;
        if (xhr.responseJSON && xhr.responseJSON.message) {
            message = xhr.responseJSON.message;
        } else if (xhr.statusText) {
            message += ` (${xhr.statusText})`;
        }
        console.error('AJAX Error:', xhr);
        showAlert('danger', message);
        return message;
    }

    // Load current user data
    function loadCurrentUser() {
        $.ajax({
            url: '/api/profile',
            method: 'GET',
            success: function(response) {
                currentUser = response;
                $('#username-display').text(response.username);
                $('#profile-username').val(response.username);
                $('#profile-email').val(response.email);
                $('#profile-role').val(response.role);
                
                // Update profile image
                const profileImage = response.image_url || '../images/placeholder.png';
                $('#profile-image-preview').attr('src', profileImage);
                $('#profile-image-url').val(response.image_url || '');
                
                // Update topbar image
                $('#user-avatar').attr('src', profileImage);
            },
            error: function(xhr) {
                handleAjaxError(xhr, 'Failed to load user profile');
            }
        });
    }

    // Load dashboard statistics
    function loadDashboardStats() {
        $.ajax({
            url: '/api/dashboard',
            method: 'GET',
            success: function(response) {
                // Load online orders separately
                $.ajax({
                    url: '/api/online/orders',
                    method: 'GET',
                    success: function(onlineOrdersResponse) {
                        // Calculate online order stats
                        const paidOnlineOrders = onlineOrdersResponse.filter(o => 
                            o.payment_status === 'paid' && o.status === 'completed').length;
                        const unpaidOnlineOrders = onlineOrdersResponse.filter(o => 
                            o.payment_status !== 'paid' || o.status !== 'completed').length;
                        
                        const totalOnlineRevenue = onlineOrdersResponse
                            .filter(o => o.payment_status === 'paid' && o.status === 'completed')
                            .reduce((sum, order) => sum + order.total, 0);
                        
                        // Update the dashboard stats
                        $('#available-tables').text(response.available_tables || 0);
                        $('#paid-orders').text(response.paid_orders || 0);
                        $('#unpaid-orders').text(response.unpaid_orders || 0);
                        $('#paid-online-orders').text(paidOnlineOrders);
                        $('#unpaid-online-orders').text(unpaidOnlineOrders);
                        $('#total-products').text(response.total_products || 0);
                        $('#total-stores').text(response.total_stores || 0);
                        $('#total-earnings').text('$' + ((response.total_revenue || 0) + totalOnlineRevenue).toFixed(2));
                        $('#total-orders').text(response.total_orders || 0);
                        $('#total-online-orders').text(onlineOrdersResponse.length || 0);
                        
                        // Recent orders
                        renderRecentOrders(response.recent_orders);
                    },
                    error: function(xhr) {
                        console.error("Failed to load online orders:", xhr);
                        updateBasicDashboardStats(response);
                    }
                });
            },
            error: function(xhr) {
                handleAjaxError(xhr, 'Failed to load dashboard statistics');
            }
        });
    }

    function updateBasicDashboardStats(response) {
        $('#available-tables').text(response.available_tables || 0);
        $('#paid-orders').text(response.paid_orders || 0);
        $('#unpaid-orders').text(response.unpaid_orders || 0);
        $('#paid-online-orders').text(0);
        $('#unpaid-online-orders').text(0);
        $('#total-products').text(response.total_products || 0);
        $('#total-stores').text(response.total_stores || 0);
        $('#total-earnings').text('$' + (response.total_revenue || 0).toFixed(2));
        $('#online-earnings').text('$0.00');
        $('#total-orders').text(response.total_orders || 0);
        $('#total-online-orders').text(0);
        
        if (response.recent_orders) {
            renderRecentOrders(response.recent_orders);
        }
    }

    function renderRecentOrders(orders) {
        const tbody = $('#recent-orders-body');
        tbody.empty();
        
        orders.forEach(order => {
            const row = `
                <tr>
                    <td>${order.id}</td>
                    <td>${order.table_number || 'Takeout'}</td>
                    <td><span class="badge ${getStatusBadgeClass(order.status)}">${order.status}</span></td>
                    <td>$${order.total_amount.toFixed(2)}</td>
                    <td>${new Date(order.created_at).toLocaleString()}</td>
                    <td>
                        <button class="btn btn-sm btn-info view-order-btn" data-id="${order.id}">
                            <i class="fas fa-eye"></i> View
                        </button>
                    </td>
                </tr>
            `;
            tbody.append(row);
        });
    }

    function getStatusBadgeClass(status) {
        const statusClasses = {
            'pending': 'badge-warning',
            'processing': 'badge-info',
            'completed': 'badge-success',
            'cancelled': 'badge-danger'
        };
        return statusClasses[status] || 'badge-secondary';
    }

    function showLoading() {
        $('body').append(`
            <div class="loading-overlay">
                <i class="fas fa-spinner fa-spin loading-spinner"></i>
            </div>
        `);
    }

    function hideLoading() {
        $('.loading-overlay').remove();
    }

    // Set up event listeners
    function setupEventListeners() {

        // Initialize online orders filters
        initOnlineOrdersFilters();

        // Toggle sidebar
        $('#toggle-btn').click(function() {
            $('#sidebar').toggleClass('collapsed');
            $('#main-content').toggleClass('collapsed');
        });
        
        // Navigation links - prevent default for hash links
        $(document).on('click', '.sidebar-menu a[href="#"]', function(e) {
            e.preventDefault();
        });
        
        // Add buttons
        $('#add-user-btn').click(showAddUserModal);
        $('#add-group-btn').click(showAddGroupModal);
        $('#add-store-btn').click(showAddStoreModal);
        $('#add-table-btn').click(showAddTableModal);
        $('#add-category-btn').click(showAddCategoryModal);
        $('#add-product-btn').click(showAddProductModal);
        $('#add-order-btn').click(showAddOrderModal);
        
        // Save buttons
        $('#save-user-btn').click(saveUser);
        $('#save-group-btn').click(saveGroup);
        $('#save-store-btn').click(saveStore);
        $('#save-table-btn').click(saveTable);
        $('#save-category-btn').click(saveCategory);
        $('#save-product-btn').click(saveProduct);
        $('#save-order-btn').click(saveOrder);
        
        // Delete confirmation
        $('#confirm-delete-btn').click(confirmDelete);
        
        // Forms
        $('#profile-form').submit(function(e) {
            e.preventDefault();
            saveProfile();
        });
        
        $('#company-info-form').submit(function(e) {
            e.preventDefault();
            saveCompanyInfo();
        });
        
        $('#settings-form').submit(function(e) {
            e.preventDefault();
            saveSettings();
        });
        
        // Order items
        $('#add-order-item-btn').click(addOrderItem);
        
        // Reports
        $(document).on('click', '#reports-content .section-tab', function() {
            $('#reports-content .section-tab').removeClass('active');
            $(this).addClass('active');
            generateReport();
        });

        $('#generate-report-btn').click(generateReport);
        
        // Delegated event handlers for dynamic content
        $(document).on('click', '.edit-user-btn', function() {
            showEditUserModal($(this).data('id'));
        });
        
        $(document).on('click', '.delete-user-btn', function() {
            showDeleteModal($(this).data('id'), 'user', $(this).data('name'));
        });
        
        // Add similar handlers for all other edit/delete buttons
        $(document).on('click', '.edit-group-btn', function() {
            showEditGroupModal($(this).data('id'));
        });
        
        $(document).on('click', '.delete-group-btn', function() {
            showDeleteModal($(this).data('id'), 'group', $(this).data('name'));
        });
        
        $(document).on('click', '.edit-store-btn', function() {
            showEditStoreModal($(this).data('id'));
        });
        
        $(document).on('click', '.delete-store-btn', function() {
            showDeleteModal($(this).data('id'), 'store', $(this).data('name'));
        });
        
        $(document).on('click', '.edit-table-btn', function() {
            showEditTableModal($(this).data('id'));
        });
        
        $(document).on('click', '.delete-table-btn', function() {
            showDeleteModal($(this).data('id'), 'table', $(this).data('name'));
        });
        
        $(document).on('click', '.edit-category-btn', function() {
            showEditCategoryModal($(this).data('id'));
        });
        
        $(document).on('click', '.delete-category-btn', function() {
            showDeleteModal($(this).data('id'), 'category', $(this).data('name'));
        });
        
        $(document).on('click', '.edit-product-btn', function() {
            showEditProductModal($(this).data('id'));
        });
        
        $(document).on('click', '.delete-product-btn', function() {
            showDeleteModal($(this).data('id'), 'product', $(this).data('name'));
        });
        
        $(document).on('click', '.edit-order-btn', function() {
            showEditOrderModal($(this).data('id'));
        });
        
        $(document).on('click', '.delete-order-btn', function() {
            showDeleteModal($(this).data('id'), 'order', 'Order #' + $(this).data('id'));
        });
        
        // Modal close buttons
        $(document).on('click', '[data-dismiss="modal"], .close', function() {
            $(this).closest('.modal').modal('hide');
        });
        
        // Online orders
        $(document).on('click', '.view-online-order-btn', function() {
            viewOnlineOrder($(this).data('id'));
        });

        $(document).on('click', '.update-online-order-btn', function() {
            updateOnlineOrderStatus($(this).data('id'));
        });

        $(document).on('click', '.delete-online-order-btn', function(e) {
            e.preventDefault();
            const orderId = $(this).data('id');
            deleteOnlineOrder(orderId);
        });

        // Online Orders Filter controls
        $(document).on('click', '#online-orders-filter-btn', function() {
            const statusFilter = $('#online-orders-status').val();
            const dateFilter = $('#online-orders-date').val();
            loadOnlineOrders(statusFilter, dateFilter);
        });
        
        // Section tabs click handler
        $(document).on('click', '#online-orders-content .section-tab', function() {
            const status = $(this).data('status');
            $('#online-orders-content .section-tab').removeClass('active');
            $(this).addClass('active');
            
            loadOnlineOrders(status, $('#online-orders-date').val(), $('#online-orders-search').val());
        });

        // Apply filters button
        $(document).on('click', '#apply-online-order-filters-btn', function() {
            const activeTab = $('#online-orders-content .section-tab.active').data('tab');
            loadOnlineOrders(activeTab, $('#online-orders-date').val(), $('#online-orders-search').val());
        });
    }

    // Add this to your existing JavaScript code
    $(document).on('pageShown', function(e, pageId) {
        switch(pageId) {
            case 'users':
                loadUsers();
                break;
            case 'groups':
                loadGroups();
                break;
            case 'stores':
                loadStores();
                break;
            case 'tables':
                loadTables();
                break;
            case 'category':
                loadCategories();
                break;
            case 'products':
                loadProducts();
                break;
            case 'orders':
                loadOrders();
                break;
            case 'online-orders':
                loadOnlineOrders();
                break;
            case 'online-order':
                deleteOnlineOrder(id);
                break;
            case 'reports':
                // Initialize reports with default date range
                const today = new Date().toISOString().split('T')[0];
                $('#report-start-date').val(today);
                $('#report-end-date').val(today);

                // Generate initial report
                generateReport();
                break;
            case 'company-info':
                loadCompanyInfo();
                break;
            case 'profile':
                // Profile data is loaded when the page loads
                break;
            case 'setting':
                loadSettings();
                break;
        }
    });

    // Show page based on URL
    function showPageFromURL() {
        console.log("showPageFromURL triggered"); // Debug log
        
        const urlParams = new URLSearchParams(window.location.search);
        const path = window.location.pathname;
        let pageId = 'dashboard';
        
        // Extract page ID from path
        if (path === '/admin/dashboard' || path === '/') {
            pageId = 'dashboard';
        } else if (path.startsWith('/admin/users')) {
            pageId = 'users';
        } else if (path.startsWith('/admin/groups')) {
            pageId = 'groups';
        } else if (path.startsWith('/admin/stores')) {
            pageId = 'stores';
        } else if (path.startsWith('/admin/tables')) {
            pageId = 'tables';
        } else if (path.startsWith('/admin/category')) {
            pageId = 'category';
        } else if (path.startsWith('/admin/products')) {
            pageId = 'products';
        } else if (path.startsWith('/admin/orders')) {
            pageId = 'orders';
        } else if (path.startsWith('/admin/online-orders')) {
            pageId = 'online-orders';
            
            // Check for URL parameters
            const statusFilter = urlParams.get('status');
            const paymentStatus = urlParams.get('payment_status');
            const dateFilter = urlParams.get('date');
            
            // Set active tab based on status filter
            if (statusFilter) {
                $('.section-tab').removeClass('active');
                $(`.section-tab[data-tab="${statusFilter}"]`).addClass('active');
            }
            
            // Load orders with filters
            loadOnlineOrders(
                statusFilter || 'all',
                dateFilter || '',
                '',
                paymentStatus || ''
            );
        } else if (path.startsWith('/admin/reports')) {
            pageId = 'reports';
        } else if (path.startsWith('/admin/company-info')) {
            pageId = 'company-info';
        } else if (path.startsWith('/admin/profile')) {
            pageId = 'profile';
        } else if (path.startsWith('/admin/setting')) {
            pageId = 'setting';
        } else if (path.startsWith('/logout')) {
            pageId = 'logout';
        }

        console.log("Determined pageId:", pageId); // Debug log
        
        // Update active menu item
        $('.sidebar-menu a').removeClass('active');
        const menuItem = $(`.sidebar-menu a[data-page="${pageId}"]`);
        if (menuItem.length) {
            menuItem.addClass('active');
        } else {
            console.warn("No menu item found for pageId:", pageId);
        }

        // Hide all pages
        $('.page-content').removeClass('active');

        // Show the selected page with appropriate initialization
        const contentDiv = $(`#${pageId}-content`);
        if (contentDiv.length) {
            contentDiv.addClass('active');
            console.log(`Showing ${pageId} page`); // Debug log
            
            // Initialize page-specific content
            switch(pageId) {
                case 'dashboard':
                    loadDashboardStats();
                    break;
                case 'users':
                    loadUsers();
                    break;
                case 'groups':
                    loadGroups();
                    break;
                case 'stores':
                    loadStores();
                    break;
                case 'tables':
                    loadTables();
                    break;
                case 'category':
                    loadCategories();
                    break;
                case 'products':
                    loadProducts();
                    break;
                case 'orders':
                    loadOrders();
                    break;
                case 'online-orders':
                    // Already handled in the URL parsing
                    break;
                case 'online-order':
                    deleteOnlineOrder(id);
                    break;
                case 'reports':
                    // Initialize reports with default date range
                    const today = new Date().toISOString().split('T')[0];
                    $('#report-start-date').val(today);
                    $('#report-end-date').val(today);
                    generateReport();
                    break;
                case 'company-info':
                    loadCompanyInfo();
                    break;
                case 'profile':
                    // Profile data is loaded when the page loads
                    break;
                case 'setting':
                    loadSettings();
                    break;
                case 'logout':
                    logout();
                    break;
            }
        } else {
            console.error(`No content div found for pageId: ${pageId}`);
            // Fallback to dashboard if page not found
            $('#dashboard-page').addClass('active');
            loadDashboardStats();
        }

        // Update breadcrumb
        updateBreadcrumb(pageId);
    }

    function updateBreadcrumb(pageId) {
        let pageName = '';
        switch(pageId) {
            case 'dashboard':
                pageName = 'Dashboard';
                break;
            case 'users':
                pageName = 'Users';
                break;
            case 'groups':
                pageName = 'Groups';
                break;
            case 'stores':
                pageName = 'Stores';
                break;
            case 'tables':
                pageName = 'Tables';
                break;
            case 'category':
                pageName = 'Category';
                break;
            case 'products':
                pageName = 'Products';
                break;
            case 'orders':
                pageName = 'Orders';
                break;
            case 'online-orders':
                pageName = 'Online Orders';
                break;
            case 'reports':
                pageName = 'Reports';
                break;
            case 'company-info':
                pageName = 'Company Info';
                break;
            case 'profile':
                pageName = 'Profile';
                break;
            case 'setting':
                pageName = 'Setting';
                break;
            case 'logout':
                pageName = 'Logout';
                break;
            default:
                pageName = 'Dashboard';
        }
        
        $('.breadcrumb').html(`
            <li><a href="/admin/dashboard">Home</a></li>
            <li>${pageName}</li>
        `);
    }

    // Show alert message
    function showAlert(type, message) {
        const alert = $(`#${type}-alert`);
        alert.removeClass('alert-success alert-danger alert-warning alert-info')
             .addClass(`alert-${type}`)
             .text(message)
             .fadeIn();
        
        setTimeout(() => {
            alert.fadeOut();
        }, 5000);
    }

    // Modal functions
    function showAddUserModal() {
        $('#user-modal-title').text('Add New User');
        $('#user-form')[0].reset();
        $('#user-id').val('');
        $('#user-modal').modal('show');
    }

    function showEditUserModal(userId) {
        $.ajax({
            url: `/api/users/${userId}`,
            method: 'GET',
            success: function(response) {
                $('#user-modal-title').text('Edit User');
                $('#user-id').val(response.id);
                $('#user-username').val(response.username);
                $('#user-email').val(response.email);
                $('#user-role').val(response.role);
                $('#user-status').val(response.active.toString());
                $('#user-password').val('');
                $('#user-modal').modal('show');
            },
            error: function(xhr) {
                handleAjaxError(xhr, 'Failed to load user data');
            }
        });
    }

    function showAddGroupModal() {
        $('#group-modal-title').text('Add New Group');
        $('#group-form')[0].reset();
        $('#group-id').val('');
        $('#group-modal').modal('show');
    }

    function showEditGroupModal(groupId) {
        $.ajax({
            url: `/api/groups/${groupId}`,
            method: 'GET',
            success: function(response) {
                $('#group-modal-title').text('Edit Group');
                $('#group-id').val(response.id);
                $('#group-name').val(response.name);
                $('#group-description').val(response.description);
                $('#group-modal').modal('show');
            },
            error: function(xhr) {
                handleAjaxError(xhr, 'Failed to load group data');
            }
        });
    }

    function showAddStoreModal() {
        $('#store-modal-title').text('Add New Store');
        $('#store-form')[0].reset();
        $('#store-id').val('');
        $('#store-modal').modal('show');
    }

    // Image URL input handler for preview
    $('#store-image').on('input', function() {
        const imageUrl = $(this).val();
        if (imageUrl) {
            $('#store-image-preview').attr('src', imageUrl);
            $('#store-image-preview-container').show();
        } else {
            $('#store-image-preview-container').hide();
        }
    });

    // Update showEditStoreModal function
    function showEditStoreModal(storeId) {
        $.ajax({
            url: `/api/stores/${storeId}`,
            method: 'GET',
            success: function(response) {
                $('#store-modal-title').text('Edit Store');
                $('#store-id').val(response.id);
                $('#store-name').val(response.name);
                $('#store-address').val(response.address);
                $('#store-phone').val(response.phone);
                $('#store-email').val(response.email);
                $('#store-image').val(response.image || '');  // Set image URL
                $('#store-opening-hours').val(response.opening_hours);
                $('#store-status').val(response.active.toString());
                
                // Show image preview if URL exists
                if (response.image) {
                    $('#store-image-preview').attr('src', response.image);
                    $('#store-image-preview-container').show();
                } else {
                    $('#store-image-preview-container').hide();
                }
                
                $('#store-modal').modal('show');
            },
            error: function(xhr) {
                handleAjaxError(xhr, 'Failed to load store data');
            }
        });
    }

    function showAddTableModal() {
        // Load stores for dropdown
        $.ajax({
            url: '/api/stores',
            method: 'GET',
            success: function(response) {
                $('#table-store').empty();
                response.forEach(store => {
                    $('#table-store').append(`<option value="${store.id}">${store.name}</option>`);
                });
                
                $('#table-modal-title').text('Add New Table');
                $('#table-form')[0].reset();
                $('#table-id').val('');
                $('#table-modal').modal('show');
            },
            error: function(xhr) {
                handleAjaxError(xhr, 'Failed to load stores');
            }
        });
    }

    function showEditTableModal(tableId) {
        // First load the table data
        $.ajax({
            url: `/api/tables/${tableId}`,
            method: 'GET',
            success: function(tableResponse) {
                // Then load stores for dropdown
                $.ajax({
                    url: '/api/stores',
                    method: 'GET',
                    success: function(storesResponse) {
                        $('#table-store').empty();
                        storesResponse.forEach(store => {
                            $('#table-store').append(
                                `<option value="${store.id}" 
                                ${store.id === tableResponse.store_id ? 'selected' : ''}>
                                ${store.name}
                                </option>`
                            );
                        });
                        
                        // Ensure the store dropdown is properly initialized
                        $('#table-store').trigger('change');
                        
                        $('#table-modal-title').text('Edit Table');
                        $('#table-id').val(tableResponse.id);
                        $('#table-number').val(tableResponse.table_number);
                        $('#table-capacity').val(tableResponse.capacity);
                        $('#table-status').val(tableResponse.status);
                        $('#table-modal').modal('show');
                    },
                    error: function(xhr) {
                        handleAjaxError(xhr, 'Failed to load stores');
                    }
                });
            },
            error: function(xhr) {
                handleAjaxError(xhr, 'Failed to load table data');
            }
        });
    }

    function showAddCategoryModal() {
        $('#category-modal-title').text('Add New Category');
        $('#category-form')[0].reset();
        $('#category-id').val('');
        $('#category-modal').modal('show');
    }

    function showEditCategoryModal(categoryId) {
        $.ajax({
            url: `/api/categories/${categoryId}`,
            method: 'GET',
            success: function(response) {
                $('#category-modal-title').text('Edit Category');
                $('#category-id').val(response.id);
                $('#category-name').val(response.name);
                $('#category-description').val(response.description);
                $('#category-image').val(response.image);
                $('#category-status').val(response.active.toString());
                $('#category-modal').modal('show');
            },
            error: function(xhr) {
                handleAjaxError(xhr, 'Failed to load category data');
            }
        });
    }

    function showAddProductModal() {
        // Load categories for dropdown
        $.ajax({
            url: '/api/categories',
            method: 'GET',
            success: function(response) {
                $('#product-category').empty();
                $('#product-category').append('<option value="">No Category</option>');
                response.forEach(category => {
                    $('#product-category').append(`<option value="${category.id}">${category.name}</option>`);
                });
                
                $('#product-modal-title').text('Add New Product');
                $('#product-form')[0].reset();
                $('#product-id').val('');
                $('#product-modal').modal('show');
            },
            error: function(xhr) {
                handleAjaxError(xhr, 'Failed to load categories');
            }
        });
    }

    function showEditProductModal(productId) {
        // First load the product data
        $.ajax({
            url: `/api/products/${productId}`,
            method: 'GET',
            success: function(productResponse) {
                // Then load categories for dropdown
                $.ajax({
                    url: '/api/categories',
                    method: 'GET',
                    success: function(categoriesResponse) {
                        $('#product-category').empty();
                        $('#product-category').append('<option value="">No Category</option>');
                        categoriesResponse.forEach(category => {
                            $('#product-category').append(`<option value="${category.id}" ${category.id === productResponse.category_id ? 'selected' : ''}>${category.name}</option>`);
                        });
                        
                        $('#product-modal-title').text('Edit Product');
                        $('#product-id').val(productResponse.id);
                        $('#product-name').val(productResponse.name);
                        $('#product-description').val(productResponse.description);
                        $('#product-price').val(productResponse.price);
                        $('#product-cost').val(productResponse.cost);
                        $('#product-image').val(productResponse.image);
                        $('#product-status').val(productResponse.available.toString());
                        $('#product-modal').modal('show');
                    },
                    error: function(xhr) {
                        handleAjaxError(xhr, 'Failed to load categories');
                    }
                });
            },
            error: function(xhr) {
                handleAjaxError(xhr, 'Failed to load product data');
            }
        });
    }

    function showAddOrderModal() {
        // Load tables for dropdown
        $.ajax({
            url: '/api/tables',
            method: 'GET',
            success: function(tablesResponse) {
                $('#order-table').empty();
                tablesResponse.forEach(table => {
                    $('#order-table').append(`<option value="${table.id}">${table.store_name} - Table ${table.table_number}</option>`);
                });
                
                // Load products for dropdown
                $.ajax({
                    url: '/api/products',
                    method: 'GET',
                    success: function(productsResponse) {
                        $('#order-product').empty();
                        productsResponse.forEach(product => {
                            if (product.available) {
                                $('#order-product').append(`<option value="${product.id}">${product.name} ($${product.price})</option>`);
                            }
                        });
                        
                        $('#order-modal-title').text('Add New Order');
                        $('#order-form')[0].reset();
                        $('#order-id').val('');
                        $('#order-items-body').empty();
                        $('#order-total-amount').text('$0.00');
                        $('#order-modal').modal('show');
                    },
                    error: function(xhr) {
                        handleAjaxError(xhr, 'Failed to load products');
                    }
                });
            },
            error: function(xhr) {
                handleAjaxError(xhr, 'Failed to load tables');
            }
        });
    }

    function showEditOrderModal(orderId) {
        // First load the order data
        $.ajax({
            url: `/api/orders/${orderId}`,
            method: 'GET',
            success: function(orderResponse) {
                // Then load tables for dropdown
                $.ajax({
                    url: '/api/tables',
                    method: 'GET',
                    success: function(tablesResponse) {
                        $('#order-table').empty();
                        tablesResponse.forEach(table => {
                            $('#order-table').append(`<option value="${table.id}" ${table.id === orderResponse.table_id ? 'selected' : ''}>${table.store_name} - Table ${table.table_number}</option>`);
                        });
                        
                        // Load products for dropdown
                        $.ajax({
                            url: '/api/products',
                            method: 'GET',
                            success: function(productsResponse) {
                                $('#order-product').empty();
                                productsResponse.forEach(product => {
                                    if (product.available) {
                                        $('#order-product').append(`<option value="${product.id}">${product.name} ($${product.price})</option>`);
                                    }
                                });
                                
                                // Populate order items
                                $('#order-items-body').empty();
                                orderResponse.items.forEach(item => {
                                    addOrderItemToTable(item.product_id, item.product_name, item.quantity, item.price, item.notes);
                                });
                                updateOrderTotal();
                                
                                $('#order-modal-title').text('Edit Order');
                                $('#order-id').val(orderResponse.id);
                                $('#order-status').val(orderResponse.status);
                                $('#order-payment-method').val(orderResponse.payment_method || '');
                                $('#order-payment-status').val(orderResponse.payment_status);
                                $('#order-notes').val(orderResponse.notes || '');
                                $('#order-modal').modal('show');
                            },
                            error: function(xhr) {
                                handleAjaxError(xhr, 'Failed to load products');
                            }
                        });
                    },
                    error: function(xhr) {
                        handleAjaxError(xhr, 'Failed to load tables');
                    }
                });
            },
            error: function(xhr) {
                handleAjaxError(xhr, 'Failed to load order data');
            }
        });
    }

    function showDeleteModal(id, type, name) {
        $('#delete-id').val(id);
        $('#delete-type').val(type);
        $('#delete-modal .modal-body p').text(`Are you sure you want to delete ${name}?`);
        $('#delete-modal').modal('show');
    }

    // Add order item to the table
    function addOrderItem() {
        const productId = $('#order-product').val();
        const productText = $('#order-product option:selected').text();
        const quantity = $('#order-quantity').val();
        const price = parseFloat(productText.match(/\$([\d.]+)/)[1]);
        
        if (!productId || quantity <= 0) {
            handleAjaxError(null, 'Please select a product and enter a valid quantity');
            return;
        }
        
        addOrderItemToTable(productId, productText.replace(/ \(\$[\d.]+\)$/, ''), quantity, price, '');
        updateOrderTotal();
        
        // Reset the form
        $('#order-quantity').val(1);
    }

    function addOrderItemToTable(productId, productName, quantity, price, notes) {
        const total = price * quantity;
        $('#order-items-body').append(`
            <tr data-product-id="${productId}">
                <td>${productName}</td>
                <td>${quantity}</td>
                <td>$${price.toFixed(2)}</td>
                <td>$${total.toFixed(2)}</td>
                <td>
                    <button class="btn btn-danger btn-sm remove-order-item-btn">
                        <i class="fas fa-trash"></i>
                    </button>
                </td>
            </tr>
        `);
        
        // Add event listener for remove button
        $('.remove-order-item-btn').off('click').on('click', function() {
            $(this).closest('tr').remove();
            updateOrderTotal();
        });
    }

    function updateOrderTotal() {
        let total = 0;
        $('#order-items-body tr').each(function() {
            const price = parseFloat($(this).find('td:eq(2)').text().replace('$', ''));
            const quantity = parseInt($(this).find('td:eq(1)').text());
            total += price * quantity;
        });
        
        $('#order-total-amount').text('$' + total.toFixed(2));
    }

    // Load data functions
    function loadUsers() {
        console.log("Loading users...");
        showLoading();

        $.ajax({
            url: '/api/users',
            method: 'GET',
            dataType: 'json',
            success: function(response) {
                console.log("Users data received:", response);

                const tbody = $('#users-table-body');
                tbody.empty();

                if (response && response.length > 0) {
                    response.forEach(user => {
                        const statusBadge = user.active ? 
                            '<span class="badge badge-success">Active</span>' : 
                            '<span class="badge badge-danger">Inactive</span>';

                        const lastLogin = user.last_login ? 
                            new Date(user.last_login).toLocaleString() : 'Never';

                        tbody.append(`
                            <tr>
                                <td>${user.id}</td>
                                <td>${user.username}</td>
                                <td>${user.email}</td>
                                <td>${user.role}</td>
                                <td>${statusBadge}</td>
                                <td>${lastLogin}</td>
                                <td>
                                    <button class="btn btn-primary btn-sm edit-user-btn" data-id="${user.id}">
                                        <i class="fas fa-edit"></i> Edit
                                    </button>
                                    <button class="btn btn-danger btn-sm delete-user-btn" data-id="${user.id}" data-name="${user.username}">
                                        <i class="fas fa-trash"></i> Delete
                                    </button>
                                </td>
                            </tr>
                        `);
                    });

                    // Reinitialize DataTable after data is loaded
                    if ($.fn.DataTable.isDataTable('#users-table')) {
                        $('#users-table').DataTable().destroy();
                    }

                    $('#users-table').DataTable({
                        responsive: true,
                        destroy: true,
                        language: {
                            emptyTable: "No users available"
                        }
                    });

                    console.log("Users table initialized successfully");
                } else {
                    console.warn("No users data received");
                    tbody.append(`
                        <tr>
                            <td colspan="7" class="text-center">No users found</td>
                        </tr>
                    `);
                }
            },
            error: function(xhr, status, error) {
                console.error("Error loading users:", status, error);
                $('#users-table-body').html(`
                    <tr>
                        <td colspan="7" class="text-center">Failed to load users</td>
                    </tr>
                `);
            },
            complete: function() {
                hideLoading();
            }
        });
    }

    function loadGroups() {
        $.ajax({
            url: '/api/groups',
            method: 'GET',
            success: function(response) {
                const tbody = $('#groups-table-body');
                tbody.empty();
                
                response.forEach(group => {
                    tbody.append(`
                        <tr>
                            <td>${group.id}</td>
                            <td>${group.name}</td>
                            <td>${group.description || ''}</td>
                            <td>${new Date(group.created_at).toLocaleDateString()}</td>
                            <td>
                                <button class="btn btn-primary btn-sm edit-group-btn" data-id="${group.id}">
                                    <i class="fas fa-edit"></i>
                                </button>
                                <button class="btn btn-danger btn-sm delete-group-btn" data-id="${group.id}" data-name="${group.name}">
                                    <i class="fas fa-trash"></i>
                                </button>
                            </td>
                        </tr>
                    `);
                });
                
                // Add event listeners to buttons
                $('.edit-group-btn').click(function() {
                    showEditGroupModal($(this).data('id'));
                });
                
                $('.delete-group-btn').click(function() {
                    showDeleteModal($(this).data('id'), 'group', $(this).data('name'));
                });
            },
            error: function(xhr) {
                handleAjaxError(xhr, 'Failed to load groups');
            }
        });
    }

    // Update loadStores function (simplified without image column)
    function loadStores() {
        $.ajax({
            url: '/api/stores',
            method: 'GET',
            success: function(response) {
                const tbody = $('#stores-table-body');
                tbody.empty();
                
                response.forEach(store => {
                    const statusBadge = store.active ? 
                        '<span class="badge badge-success">Active</span>' : 
                        '<span class="badge badge-danger">Inactive</span>';
                    
                    tbody.append(`
                        <tr>
                            <td>${store.id}</td>
                            <td>${store.name}</td>
                            <td>${store.address || ''}</td>
                            <td>${store.phone || ''}</td>
                            <td>${statusBadge}</td>
                            <td>
                                <button class="btn btn-primary btn-sm edit-store-btn" data-id="${store.id}">
                                    <i class="fas fa-edit"></i>
                                </button>
                                <button class="btn btn-danger btn-sm delete-store-btn" data-id="${store.id}" data-name="${store.name}">
                                    <i class="fas fa-trash"></i>
                                </button>
                            </td>
                        </tr>
                    `);
                });
                
                // Reinitialize DataTable if needed
                if ($.fn.DataTable.isDataTable('#stores-table')) {
                    $('#stores-table').DataTable().destroy();
                }
                $('#stores-table').DataTable({
                    responsive: true,
                    destroy: true
                });
            },
            error: function(xhr) {
                handleAjaxError(xhr, 'Failed to load stores');
            }
        });
    }

    function loadTables() {
        $.ajax({
            url: '/api/tables',
            method: 'GET',
            success: function(response) {
                const tbody = $('#tables-table-body');
                tbody.empty();
                
                response.forEach(table => {
                    let statusBadge;
                    switch(table.status) {
                        case 'available':
                            statusBadge = '<span class="badge badge-success">Available</span>';
                            break;
                        case 'occupied':
                            statusBadge = '<span class="badge badge-danger">Occupied</span>';
                            break;
                        case 'reserved':
                            statusBadge = '<span class="badge badge-warning">Reserved</span>';
                            break;
                        case 'cleaning':
                            statusBadge = '<span class="badge badge-info">Cleaning</span>';
                            break;
                        default:
                            statusBadge = '<span class="badge badge-secondary">Unknown</span>';
                    }
                    
                    tbody.append(`
                        <tr>
                            <td>${table.id}</td>
                            <td>${table.store_name || ''}</td>
                            <td>${table.table_number}</td>
                            <td>${table.capacity}</td>
                            <td>${statusBadge}</td>
                            <td>
                                <button class="btn btn-primary btn-sm edit-table-btn" data-id="${table.id}">
                                    <i class="fas fa-edit"></i>
                                </button>
                                <button class="btn btn-danger btn-sm delete-table-btn" data-id="${table.id}" data-name="Table ${table.table_number}">
                                    <i class="fas fa-trash"></i>
                                </button>
                            </td>
                        </tr>
                    `);
                });
                
                // Add event listeners to buttons
                $('.edit-table-btn').click(function() {
                    showEditTableModal($(this).data('id'));
                });
                
                $('.delete-table-btn').click(function() {
                    showDeleteModal($(this).data('id'), 'table', $(this).data('name'));
                });
            },
            error: function(xhr) {
                handleAjaxError(xhr, 'Failed to load tables');
            }
        });
    }

    function loadCategories() {
        $.ajax({
            url: '/api/categories',
            method: 'GET',
            success: function(response) {
                const tbody = $('#categories-table-body');
                tbody.empty();
                
                response.forEach(category => {
                    const statusBadge = category.active ? 
                        '<span class="badge badge-success">Active</span>' : 
                        '<span class="badge badge-danger">Inactive</span>';
                    
                    tbody.append(`
                        <tr>
                            <td>${category.id}</td>
                            <td>${category.name}</td>
                            <td>${category.description || ''}</td>
                            <td>${statusBadge}</td>
                            <td>
                                <button class="btn btn-primary btn-sm edit-category-btn" data-id="${category.id}">
                                    <i class="fas fa-edit"></i>
                                </button>
                                <button class="btn btn-danger btn-sm delete-category-btn" data-id="${category.id}" data-name="${category.name}">
                                    <i class="fas fa-trash"></i>
                                </button>
                            </td>
                        </tr>
                    `);
                });
                
                // Add event listeners to buttons
                $('.edit-category-btn').click(function() {
                    showEditCategoryModal($(this).data('id'));
                });
                
                $('.delete-category-btn').click(function() {
                    showDeleteModal($(this).data('id'), 'category', $(this).data('name'));
                });
            },
            error: function(xhr) {
                handleAjaxError(xhr, 'Failed to load categories');
            }
        });
    }

    function loadProducts() {
        $.ajax({
            url: '/api/products',
            method: 'GET',
            success: function(response) {
                const tbody = $('#products-table-body');
                tbody.empty();
                
                response.forEach(product => {
                    const statusBadge = product.available ? 
                        '<span class="badge badge-success">Available</span>' : 
                        '<span class="badge badge-danger">Unavailable</span>';
                    
                    tbody.append(`
                        <tr>
                            <td>${product.id}</td>
                            <td>${product.name}</td>
                            <td>${product.category_name || 'No Category'}</td>
                            <td>$${product.price.toFixed(2)}</td>
                            <td>${product.cost ? '$' + product.cost.toFixed(2) : '-'}</td>
                            <td>${statusBadge}</td>
                            <td>
                                <button class="btn btn-primary btn-sm edit-product-btn" data-id="${product.id}">
                                    <i class="fas fa-edit"></i>
                                </button>
                                <button class="btn btn-danger btn-sm delete-product-btn" data-id="${product.id}" data-name="${product.name}">
                                    <i class="fas fa-trash"></i>
                                </button>
                            </td>
                        </tr>
                    `);
                });
                
                // Add event listeners to buttons
                $('.edit-product-btn').click(function() {
                    showEditProductModal($(this).data('id'));
                });
                
                $('.delete-product-btn').click(function() {
                    showDeleteModal($(this).data('id'), 'product', $(this).data('name'));
                });
            },
            error: function(xhr) {
                handleAjaxError(xhr, 'Failed to load products');
            }
        });
    }

    function loadOrders() {
        $.ajax({
            url: '/api/orders',
            method: 'GET',
            success: function(response) {
                const tbody = $('#orders-table-body');
                tbody.empty();
                
                response.forEach(order => {
                    let statusBadge;
                    switch(order.status) {
                        case 'pending':
                            statusBadge = '<span class="badge badge-warning">Pending</span>';
                            break;
                        case 'processing':
                            statusBadge = '<span class="badge badge-info">Processing</span>';
                            break;
                        case 'completed':
                            statusBadge = '<span class="badge badge-success">Completed</span>';
                            break;
                        case 'cancelled':
                            statusBadge = '<span class="badge badge-danger">Cancelled</span>';
                            break;
                        default:
                            statusBadge = '<span class="badge badge-secondary">Unknown</span>';
                    }
                    
                    let paymentStatusBadge;
                    switch(order.payment_status) {
                        case 'paid':
                            paymentStatusBadge = '<span class="badge badge-success">Paid</span>';
                            break;
                        case 'unpaid':
                            paymentStatusBadge = '<span class="badge badge-danger">Unpaid</span>';
                            break;
                        case 'refunded':
                            paymentStatusBadge = '<span class="badge badge-info">Refunded</span>';
                            break;
                        default:
                            paymentStatusBadge = '<span class="badge badge-secondary">Unknown</span>';
                    }
                    
                    tbody.append(`
                        <tr>
                            <td>${order.id}</td>
                            <td>${order.table_number || 'No Table'}</td>
                            <td>${order.username || 'System'}</td>
                            <td>${statusBadge}</td>
                            <td>$${order.total_amount.toFixed(2)}</td>
                            <td>${paymentStatusBadge}</td>
                            <td>${new Date(order.created_at).toLocaleString()}</td>
                            <td>
                                <button class="btn btn-primary btn-sm edit-order-btn" data-id="${order.id}">
                                    <i class="fas fa-edit"></i>
                                </button>
                                <button class="btn btn-danger btn-sm delete-order-btn" data-id="${order.id}">
                                    <i class="fas fa-trash"></i>
                                </button>
                            </td>
                        </tr>
                    `);
                });
                
                // Add event listeners to buttons
                $('.edit-order-btn').click(function() {
                    showEditOrderModal($(this).data('id'));
                });
                
                $('.delete-order-btn').click(function() {
                    showDeleteModal($(this).data('id'), 'order', 'Order #' + $(this).data('id'));
                });
            },
            error: function(xhr) {
                handleAjaxError(xhr, 'Failed to load orders');
            }
        });
    }

    function loadCompanyInfo() {
        $.ajax({
            url: '/api/settings',
            method: 'GET',
            success: function(response) {
                $('#company-name').val(response.company_name || '');
                $('#company-address').val(response.address || '');
                $('#company-phone').val(response.phone || '');
                $('#company-email').val(response.email || '');
                $('#company-opening-hours').val(response.opening_hours || '');
            },
            error: function(xhr) {
                handleAjaxError(xhr, 'Failed to load company info');
            }
        });
    }

    function loadSettings() {
        $.ajax({
            url: '/api/settings',
            method: 'GET',
            success: function(response) {
                $('#setting-currency').val(response.currency || '$');
                $('#setting-tax-rate').val(response.tax_rate || 0.1);
                $('#setting-timezone').val(response.timezone || 'UTC');
                $('#setting-date-format').val(response.date_format || 'YYYY-MM-DD');
            },
            error: function(xhr) {
                handleAjaxError(xhr, 'Failed to load settings');
            }
        });
    }

    // Save functions
    function saveUser() {
        const id = $('#user-id').val();
        const url = id ? `/api/users/${id}` : '/api/users';
        const method = id ? 'PUT' : 'POST';
        
        const data = {
            username: $('#user-username').val().trim(),
            email: $('#user-email').val().trim(),
            role: $('#user-role').val(),
            active: $('#user-status').val() === 'true',
            password: $('#user-password').val() || undefined
        };

        console.log("Attempting to save user with data:", data); // Debug log
        
        // Client-side validation
        if (!data.username) {
            handleAjaxError(null, 'Username is required');
            return;
        }
        if (!data.email) {
            handleAjaxError(null, 'Email is required');
            return;
        }
        if (!id && !data.password) {
            handleAjaxError(null, 'Password is required for new users');
            return;
        }
        if (data.password && !validatePassword(data.password)) {
            handleAjaxError(null, 'Password must be 8+ characters with uppercase, lowercase and number');
            return;
        }
        
        $.ajax({
            url: url,
            method: method,
            contentType: 'application/json',
            data: JSON.stringify(data),
            success: function(response) {
                console.log("Success response:", response); // Debug log
                $('#user-modal').modal('hide');
                showAlert('success', response.message);
                loadUsers();
            },
            error: function(xhr) {
                console.error("Error response:", xhr.responseJSON); // Debug log
                const errorMsg = xhr.responseJSON?.message || 'Failed to save user';
                handleAjaxError(xhr, errorMsg);
            }
        });
    }

    function validatePassword(password) {
        if (password.length < 8) return false;
        if (!/[A-Z]/.test(password)) return false;
        if (!/[a-z]/.test(password)) return false;
        if (!/[0-9]/.test(password)) return false;
        return true;
    }

    function saveGroup() {
        const id = $('#group-id').val();
        const url = id ? `/api/groups/${id}` : '/api/groups';
        const method = id ? 'PUT' : 'POST';
        
        const data = {
            name: $('#group-name').val(),
            description: $('#group-description').val(),
            permissions: '{}' // In a real app, this would be collected from checkboxes
        };
        
        $.ajax({
            url: url,
            method: method,
            contentType: 'application/json',
            data: JSON.stringify(data),
            success: function(response) {
                $('#group-modal').modal('hide');
                showAlert('success', response.message);
                loadGroups();
            },
            error: function(xhr) {
                handleAjaxError(xhr, 'Failed to save group');
            }
        });
    }

    // Update saveStore function
    function saveStore() {
        const id = $('#store-id').val();
        const url = id ? `/api/stores/${id}` : '/api/stores';
        const method = id ? 'PUT' : 'POST';
        
        const data = {
            name: $('#store-name').val(),
            address: $('#store-address').val(),
            phone: $('#store-phone').val(),
            email: $('#store-email').val(),
            image: $('#store-image').val() || '',  // Include image URL
            opening_hours: $('#store-opening-hours').val(),
            active: $('#store-status').val() === 'true'
        };
        
        $.ajax({
            url: url,
            method: method,
            contentType: 'application/json',
            data: JSON.stringify(data),
            success: function(response) {
                $('#store-modal').modal('hide');
                showAlert('success', response.message);
                loadStores();
            },
            error: function(xhr) {
                handleAjaxError(xhr, 'Failed to save store');
            }
        });
    }

    function saveTable() {
        const id = $('#table-id').val();
        const url = id ? `/api/tables/${id}` : '/api/tables';
        const method = id ? 'PUT' : 'POST';
        
        const data = {
            store_id: $('#table-store').val(),
            table_number: $('#table-number').val(),
            capacity: $('#table-capacity').val(),
            status: $('#table-status').val()
        };
        
        console.log("Saving table with data:", data); // Debug log
        
        $.ajax({
            url: url,
            method: method,
            contentType: 'application/json',
            data: JSON.stringify(data),
            success: function(response) {
                console.log("Save successful:", response);
                $('#table-modal').modal('hide');
                showAlert('success', response.message);
                loadTables();
            },
            error: function(xhr) {
                console.error("Save failed:", xhr.responseJSON);
                handleAjaxError(xhr, 'Failed to save table');
            }
        });
    }

    function saveCategory() {
        const id = $('#category-id').val();
        const url = id ? `/api/categories/${id}` : '/api/categories';
        const method = id ? 'PUT' : 'POST';
        
        const data = {
            name: $('#category-name').val(),
            description: $('#category-description').val(),
            image: $('#category-image').val(),
            active: $('#category-status').val() === 'true'
        };
        
        $.ajax({
            url: url,
            method: method,
            contentType: 'application/json',
            data: JSON.stringify(data),
            success: function(response) {
                $('#category-modal').modal('hide');
                showAlert('success', response.message);
                loadCategories();
            },
            error: function(xhr) {
                handleAjaxError(xhr, 'Failed to save category');
            }
        });
    }

    function saveProduct() {
        const id = $('#product-id').val();
        const url = id ? `/api/products/${id}` : '/api/products';
        const method = id ? 'PUT' : 'POST';
        
        const categoryId = $('#product-category').val();
        
        const data = {
            name: $('#product-name').val(),
            description: $('#product-description').val(),
            price: parseFloat($('#product-price').val()),
            cost: $('#product-cost').val() ? parseFloat($('#product-cost').val()) : null,
            category_id: categoryId ? parseInt(categoryId) : null,
            image: $('#product-image').val(),
            available: $('#product-status').val() === 'true'
        };
        
        $.ajax({
            url: url,
            method: method,
            contentType: 'application/json',
            data: JSON.stringify(data),
            success: function(response) {
                $('#product-modal').modal('hide');
                showAlert('success', response.message);
                loadProducts();
            },
            error: function(xhr) {
                handleAjaxError(xhr, 'Failed to save product');
            }
        });
    }

    function saveOrder() {
        const id = $('#order-id').val();
        const url = id ? `/api/orders/${id}` : '/api/orders';
        const method = id ? 'PUT' : 'POST';
        
        // Collect order items
        const items = [];
        $('#order-items-body tr').each(function() {
            const productId = $(this).data('product-id');
            const quantity = parseInt($(this).find('td:eq(1)').text());
            const price = parseFloat($(this).find('td:eq(2)').text().replace('$', ''));
            
            items.push({
                product_id: productId,
                quantity: quantity,
                price: price
            });
        });
        
        if (items.length === 0) {
            handleAjaxError(xhr, 'Please add at least one item to the order');
            return;
        }
        
        const data = {
            table_id: $('#order-table').val(),
            status: $('#order-status').val(),
            payment_method: $('#order-payment-method').val() || null,
            payment_status: $('#order-payment-status').val(),
            notes: $('#order-notes').val() || null,
            items: items
        };
        
        $.ajax({
            url: url,
            method: method,
            contentType: 'application/json',
            data: JSON.stringify(data),
            success: function(response) {
                $('#order-modal').modal('hide');
                showAlert('success', response.message);
                loadOrders();
            },
            error: function(xhr) {
                handleAjaxError(xhr, 'Failed to save order');
            }
        });
    }

    function saveProfile() {
        const data = {
            email: $('#profile-email').val(),
            image_url: $('#profile-image-url').val() || null,
            current_password: $('#profile-current-password').val() || undefined,
            password: $('#profile-new-password').val() || undefined
        };
        
        if (data.password && data.password !== $('#profile-confirm-password').val()) {
            handleAjaxError(null, 'New password and confirmation do not match');
            return;
        }
        
        $.ajax({
            url: '/api/profile',
            method: 'PUT',
            contentType: 'application/json',
            data: JSON.stringify(data),
            success: function(response) {
                showAlert('success', response.message);
                loadCurrentUser();
                $('#profile-current-password').val('');
                $('#profile-new-password').val('');
                $('#profile-confirm-password').val('');
            },
            error: function(xhr) {
                handleAjaxError(xhr, 'Failed to update profile');
            }
        });
    }

    function saveCompanyInfo() {
        const data = {
            company_name: $('#company-name').val(),
            address: $('#company-address').val(),
            phone: $('#company-phone').val(),
            email: $('#company-email').val(),
            opening_hours: $('#company-opening-hours').val()
        };
        
        $.ajax({
            url: '/api/settings',
            method: 'PUT',
            contentType: 'application/json',
            data: JSON.stringify(data),
            success: function(response) {
                showAlert('success', response.message);
            },
            error: function(xhr) {
                handleAjaxError(xhr, 'Failed to save company info');
            }
        });
    }

    function saveSettings() {
        const data = {
            currency: $('#setting-currency').val(),
            tax_rate: parseFloat($('#setting-tax-rate').val()),
            timezone: $('#setting-timezone').val(),
            date_format: $('#setting-date-format').val()
        };
        
        $.ajax({
            url: '/api/settings',
            method: 'PUT',
            contentType: 'application/json',
            data: JSON.stringify(data),
            success: function(response) {
                showAlert('success', response.message);
            },
            error: function(xhr) {
                handleAjaxError(xhr, 'Failed to save settings');
            }
        });
    }

    function confirmDelete() {
        const id = $('#delete-id').val();
        const type = $('#delete-type').val();
        const url = `/api/${type}s/${id}`;
        
        $.ajax({
            url: url,
            method: 'DELETE',
            success: function(response) {
                $('#delete-modal').modal('hide');
                showAlert('success', response.message);
                
                // Reload the appropriate data
                switch(type) {
                    case 'user':
                        loadUsers();
                        break;
                    case 'group':
                        loadGroups();
                        break;
                    case 'store':
                        loadStores();
                        break;
                    case 'table':
                        loadTables();
                        break;
                    case 'category':
                        loadCategories();
                        break;
                    case 'product':
                        loadProducts();
                        break;
                    case 'order':
                        loadOrders();
                        break;
                    case 'online-orders':
                        loadOnlineOrders();
                        break;
                    case 'online-order':
                        deleteOnlineOrder(id);
                        break;
                }
            },
            error: function(xhr) {
                handleAjaxError(xhr, 'Failed to delete item');
            }
        });
    }

    // Initialize report dates and period selector
    function initReportDates() {
        const today = new Date();
        const period = $('#report-period').val();
        
        // Set default dates
        const startDate = new Date(today);
        if (period === 'weekly') startDate.setDate(today.getDate() - 7);
        else if (period === 'monthly') startDate.setMonth(today.getMonth() - 1);
        else if (period === 'yearly') startDate.setFullYear(today.getFullYear() - 1);
        
        $('#report-start-date').val(startDate.toISOString().split('T')[0]);
        $('#report-end-date').val(today.toISOString().split('T')[0]);
        
        // Show/hide date inputs based on period
        toggleDateInputs(period);
    }

    function toggleDateInputs(period) {
        if (period === 'custom') {
            $('#start-date-col').show();
            $('#end-date-col').show();
        } else {
            $('#start-date-col').hide();
            $('#end-date-col').hide();
        }
    }

    // Update date range based on selected period
    function updateDateRange(period) {
        const today = new Date();
        const startDate = new Date(today);
        
        switch (period) {
            case 'daily':
                // Just today
                break;
            case 'weekly':
                startDate.setDate(today.getDate() - 7);
                break;
            case 'monthly':
                startDate.setMonth(today.getMonth() - 1);
                break;
            case 'yearly':
                startDate.setFullYear(today.getFullYear() - 1);
                break;
            case 'custom':
                return; // Don't modify dates for custom range
        }
        
        $('#report-start-date').val(startDate.toISOString().split('T')[0]);
        $('#report-end-date').val(today.toISOString().split('T')[0]);
    }

    Date.prototype.getWeek = function() {
        const date = new Date(this.getTime());
        date.setHours(0, 0, 0, 0);
        date.setDate(date.getDate() + 3 - (date.getDay() + 6) % 7);
        const week1 = new Date(date.getFullYear(), 0, 4);
        return 1 + Math.round(((date.getTime() - week1.getTime()) / 86400000 - 3 + (week1.getDay() + 6) % 7) / 7);
    };

    function generateReport() {
        const period = $('#report-period').val();
        let startDate = $('#report-start-date').val();
        let endDate = $('#report-end-date').val();
        const reportType = $('.section-tab.active').data('report-type') || 'all';
        
        // Validate dates
        if (!startDate || !endDate) {
            showAlert('danger', 'Please select valid dates');
            return;
        }
        
        if (new Date(endDate) < new Date(startDate)) {
            showAlert('danger', 'End date cannot be before start date');
            return;
        }
        
        showLoading();
        
        // First get restaurant orders report
        $.ajax({
            url: '/api/reports/sales',
            method: 'GET',
            data: {
                start_date: startDate,
                end_date: endDate,
                period: period,
                type: reportType,
                payment_status: 'paid' // Only get paid orders for revenue
            },
            success: function(restaurantResponse) {
                // Then get unpaid restaurant orders
                $.ajax({
                    url: '/api/reports/sales',
                    method: 'GET',
                    data: {
                        start_date: startDate,
                        end_date: endDate,
                        period: period,
                        type: reportType,
                        payment_status: 'unpaid' // Get unpaid orders separately
                    },
                    success: function(unpaidRestaurantResponse) {
                        // Then get online orders report (paid only)
                        $.ajax({
                            url: '/api/reports/online-orders',
                            method: 'GET',
                            data: {
                                start_date: startDate,
                                end_date: endDate,
                                period: period,
                                status: 'completed', // Only completed orders
                                payment_status: 'paid' // Only paid orders
                            },
                            success: function(onlineResponse) {
                                // Then get unpaid online orders
                                $.ajax({
                                    url: '/api/reports/online-orders',
                                    method: 'GET',
                                    data: {
                                        start_date: startDate,
                                        end_date: endDate,
                                        period: period,
                                        payment_status: 'unpaid' // Get unpaid online orders
                                    },
                                    success: function(unpaidOnlineResponse) {
                                        // Combine all reports
                                        const combinedResponse = {
                                            restaurant: restaurantResponse,
                                            unpaidRestaurant: unpaidRestaurantResponse,
                                            online: onlineResponse,
                                            unpaidOnline: unpaidOnlineResponse,
                                            period: period,
                                            start_date: startDate,
                                            end_date: endDate
                                        };
                                        
                                        updateReportUI(combinedResponse);
                                        
                                        // Enable PDF download button
                                        $('#generate-pdf-btn').off('click').on('click', function() {
                                            generatePDF(combinedResponse);
                                        }).show();
                                    },
                                    error: function(xhr) {
                                        handleAjaxError(xhr, 'Failed to load unpaid online orders');
                                    }
                                });
                            },
                            error: function(xhr) {
                                handleAjaxError(xhr, 'Failed to load online orders report');
                            }
                        });
                    },
                    error: function(xhr) {
                        handleAjaxError(xhr, 'Failed to load unpaid restaurant orders');
                    }
                });
            },
            error: function(xhr) {
                handleAjaxError(xhr, 'Failed to generate restaurant report');
            },
            complete: function() {
                hideLoading();
            }
        });
    }

    // Update the report UI with new data
    function updateReportUI(data) {
        if (!data) {
            showAlert('danger', 'No report data received');
            return;
        }

        // Calculate combined totals
        const restaurantSales = data.restaurant.total_sales || 0;
        const restaurantOrders = data.restaurant.total_orders || 0;
        const onlineSales = data.online.total_sales || 0;
        const onlineOrders = data.online.total_orders || 0;
        
        // Calculate unpaid amounts
        const unpaidRestaurant = data.unpaidRestaurant.total_sales || 0;
        const unpaidRestaurantOrders = data.unpaidRestaurant.total_orders || 0;
        const unpaidOnline = data.unpaidOnline.total_sales || 0;
        const unpaidOnlineOrders = data.unpaidOnline.total_orders || 0;
        
        const combinedSales = restaurantSales + onlineSales;
        const combinedOrders = restaurantOrders + onlineOrders;
        const combinedUnpaid = unpaidRestaurant + unpaidOnline;
        const combinedUnpaidOrders = unpaidRestaurantOrders + unpaidOnlineOrders;
        const avgOrderValue = combinedOrders > 0 ? (combinedSales / combinedOrders) : 0;
        
        // Update sales summary
        $('#sales-summary').html(`
            <div class="stat-number">$${combinedSales.toFixed(2)}</div>
            <div class="stat-label">Total Revenue (Paid Orders)</div>
            
            <div class="stat-number text-danger">$${combinedUnpaid.toFixed(2)}</div>
            <div class="stat-label text-danger">Unpaid Orders Amount</div>
            
            <div class="stat-number">${combinedOrders}</div>
            <div class="stat-label">Paid Orders Count</div>
            
            <div class="stat-number text-danger">${combinedUnpaidOrders}</div>
            <div class="stat-label text-danger">Unpaid Orders Count</div>
            
            <div class="stat-number">$${avgOrderValue.toFixed(2)}</div>
            <div class="stat-label">Average Paid Order Value</div>
            
            <div class="stat-number">${restaurantOrders}</div>
            <div class="stat-label">Restaurant Paid Orders</div>
            
            <div class="stat-number text-danger">${unpaidRestaurantOrders}</div>
            <div class="stat-label text-danger">Restaurant Unpaid Orders</div>
            
            <div class="stat-number">${onlineOrders}</div>
            <div class="stat-label">Online Paid Orders</div>
            
            <div class="stat-number text-danger">${unpaidOnlineOrders}</div>
            <div class="stat-label text-danger">Online Unpaid Orders</div>
        `);
        
        // Combine top products from both restaurant and online
        const allProducts = [];
        
        // Add restaurant products
        if (data.restaurant.top_products) {
            data.restaurant.top_products.forEach(product => {
                allProducts.push({
                    name: product.name,
                    quantity: product.quantity,
                    revenue: product.revenue,
                    type: 'restaurant'
                });
            });
        }
        
        // Add online products
        if (data.online.top_products) {
            data.online.top_products.forEach(product => {
                const existing = allProducts.find(p => p.name === product.name);
                if (existing) {
                    existing.quantity += product.quantity;
                    existing.revenue += product.revenue;
                } else {
                    allProducts.push({
                        name: product.name,
                        quantity: product.quantity,
                        revenue: product.revenue,
                        type: 'online'
                    });
                }
            });
        }
        
        // Sort by revenue and take top 10
        const topProducts = allProducts.sort((a, b) => b.revenue - a.revenue).slice(0, 10);
        
        // Update top products display
        let topProductsHtml = '<ul class="list-group">';
        if (topProducts.length > 0) {
            topProducts.forEach(product => {
                topProductsHtml += `
                    <li class="list-group-item d-flex justify-content-between align-items-center">
                        ${product.name || 'Unknown Product'}
                        <span class="badge badge-primary badge-pill">
                            $${(product.revenue || 0).toFixed(2)} (${product.quantity || 0} sold)
                        </span>
                        <small class="text-muted">${product.type}</small>
                    </li>
                `;
            });
        } else {
            topProductsHtml += '<li class="list-group-item">No products sold in this period</li>';
        }
        topProductsHtml += '</ul>';
        $('#top-products').html(topProductsHtml);
        
        // Prepare chart data - combine restaurant and online sales by period
        const chartData = [];
        const restaurantChartData = data.restaurant.chart_data || [];
        const onlineChartData = data.online.chart_data || [];
        
        // Combine data points by date/period
        const allDates = new Set([
            ...restaurantChartData.map(item => item.date),
            ...onlineChartData.map(item => item.date)
        ]);
        
        Array.from(allDates).sort().forEach(date => {
            const restaurantItem = restaurantChartData.find(item => item.date === date) || { sales: 0 };
            const onlineItem = onlineChartData.find(item => item.date === date) || { sales: 0 };
            
            chartData.push({
                date: date,
                restaurant: restaurantItem.sales,
                online: onlineItem.sales,
                total: restaurantItem.sales + onlineItem.sales
            });
        });
        
        // Update sales chart
        if (chartData.length > 0) {
            updateSalesChart(chartData, data.period);
        } else {
            const ctx = document.getElementById('sales-chart').getContext('2d');
            if (salesChart) {
                salesChart.destroy();
                salesChart = null;
            }
            ctx.clearRect(0, 0, ctx.canvas.width, ctx.canvas.height);
            ctx.font = '16px Arial';
            ctx.fillStyle = '#666';
            ctx.textAlign = 'center';
            ctx.fillText('No sales data available for selected period', ctx.canvas.width/2, ctx.canvas.height/2);
        }
        
        // Update order types breakdown chart
        updateOrderTypesChart({
            restaurant: restaurantSales,
            online: onlineSales
        });
    }

    function updateOrderTypesChart(orderTypes) {
        const ctx = document.getElementById('order-types-chart').getContext('2d');
        
        // Destroy previous chart if it exists
        if (window.orderTypesChart) {
            window.orderTypesChart.destroy();
        }
        
        const labels = ['Restaurant', 'Online'];
        const data = [orderTypes.restaurant || 0, orderTypes.online || 0];
        const backgroundColors = [
            'rgba(78, 115, 223, 0.8)', // Restaurant color
            'rgba(28, 200, 138, 0.8)'  // Online color
        ];
        
        window.orderTypesChart = new Chart(ctx, {
            type: 'doughnut',
            data: {
                labels: labels,
                datasets: [{
                    data: data,
                    backgroundColor: backgroundColors,
                    borderWidth: 1
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                plugins: {
                    legend: {
                        position: 'right'
                    },
                    tooltip: {
                        callbacks: {
                            label: function(context) {
                                return `${context.label}: $${context.raw.toFixed(2)}`;
                            }
                        }
                    }
                }
            }
        });
    }

    // Helper function for chart colors
    function getChartColorForType(type) {
        const colors = {
            'restaurant': 'rgba(78, 115, 223, 0.8)',
            'online': 'rgba(28, 200, 138, 0.8)',
            'takeout': 'rgba(246, 194, 62, 0.8)',
            'delivery': 'rgba(231, 74, 59, 0.8)'
        };
        return colors[type] || 'rgba(54, 185, 204, 0.8)';
    }

    // Update chart with period grouping
    function updateSalesChart(chartData, period) {
        const ctx = document.getElementById('sales-chart').getContext('2d');
        
        // Destroy previous chart if it exists
        if (salesChart) {
            salesChart.destroy();
        }
        
        // Extract labels and data
        const labels = chartData.map(item => item.date);
        const restaurantData = chartData.map(item => item.restaurant || 0);
        const onlineData = chartData.map(item => item.online || 0);
        const totalData = chartData.map(item => item.total || 0);
        
        salesChart = new Chart(ctx, {
            type: period === 'daily' ? 'bar' : 'line',
            data: {
                labels: labels,
                datasets: [
                    {
                        label: 'Restaurant Sales ($)',
                        data: restaurantData,
                        backgroundColor: 'rgba(78, 115, 223, 0.5)',
                        borderColor: 'rgba(78, 115, 223, 1)',
                        borderWidth: 2,
                        fill: true
                    },
                    {
                        label: 'Online Sales ($)',
                        data: onlineData,
                        backgroundColor: 'rgba(28, 200, 138, 0.5)',
                        borderColor: 'rgba(28, 200, 138, 1)',
                        borderWidth: 2,
                        fill: true
                    },
                    {
                        label: 'Total Sales ($)',
                        data: totalData,
                        backgroundColor: 'rgba(231, 74, 59, 0.5)',
                        borderColor: 'rgba(231, 74, 59, 1)',
                        borderWidth: 2,
                        fill: false,
                        hidden: true // Hide total by default
                    }
                ]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                scales: {
                    y: {
                        beginAtZero: true,
                        ticks: {
                            callback: function(value) {
                                return '$' + value;
                            }
                        }
                    },
                    x: {
                        ticks: {
                            autoSkip: true,
                            maxRotation: 45,
                            minRotation: 45
                        }
                    }
                },
                plugins: {
                    tooltip: {
                        callbacks: {
                            label: function(context) {
                                return context.dataset.label + ': $' + context.raw.toFixed(2);
                            }
                        }
                    },
                    legend: {
                        position: 'top'
                    }
                }
            }
        });
    }

    function generatePDF(reportData) {
        showLoading();
        
        const period = $('#report-period').val();
        const startDate = $('#report-start-date').val();
        const endDate = $('#report-end-date').val();
        
        const restaurantSales = reportData.restaurant.total_sales || 0;
        const restaurantOrders = reportData.restaurant.total_orders || 0;
        const onlineSales = reportData.online.total_sales || 0;
        const onlineOrders = reportData.online.total_orders || 0;
        
        // Get unpaid amounts
        const unpaidRestaurant = reportData.unpaidRestaurant.total_sales || 0;
        const unpaidRestaurantOrders = reportData.unpaidRestaurant.total_orders || 0;
        const unpaidOnline = reportData.unpaidOnline.total_sales || 0;
        const unpaidOnlineOrders = reportData.unpaidOnline.total_orders || 0;
        
        const combinedSales = restaurantSales + onlineSales;
        const combinedOrders = restaurantOrders + onlineOrders;
        const combinedUnpaid = unpaidRestaurant + unpaidOnline;
        const combinedUnpaidOrders = unpaidRestaurantOrders + unpaidOnlineOrders;
        const avgOrderValue = combinedOrders > 0 ? (combinedSales / combinedOrders) : 0;
        
        let htmlContent = `
            <h1 style="text-align: center;">Sales Report</h1>
            <p style="text-align: center;">
                ${period.charAt(0).toUpperCase() + period.slice(1)} Report from 
                ${new Date(startDate).toLocaleDateString()} to 
                ${new Date(endDate).toLocaleDateString()}
            </p>
            
            <h2>Summary</h2>
            <table style="width: 100%; border-collapse: collapse; margin-bottom: 20px;">
                <tr>
                    <td style="border: 1px solid #ddd; padding: 8px; font-weight: bold;">Total Revenue (Paid Orders)</td>
                    <td style="border: 1px solid #ddd; padding: 8px;">$${combinedSales.toFixed(2)}</td>
                </tr>
                <tr>
                    <td style="border: 1px solid #ddd; padding: 8px; font-weight: bold;">Unpaid Orders Amount</td>
                    <td style="border: 1px solid #ddd; padding: 8px; color: red;">$${combinedUnpaid.toFixed(2)}</td>
                </tr>
                <tr>
                    <td style="border: 1px solid #ddd; padding: 8px; font-weight: bold;">Restaurant Revenue</td>
                    <td style="border: 1px solid #ddd; padding: 8px;">$${restaurantSales.toFixed(2)}</td>
                </tr>
                <tr>
                    <td style="border: 1px solid #ddd; padding: 8px; font-weight: bold;">Restaurant Unpaid</td>
                    <td style="border: 1px solid #ddd; padding: 8px; color: red;">$${unpaidRestaurant.toFixed(2)}</td>
                </tr>
                <tr>
                    <td style="border: 1px solid #ddd; padding: 8px; font-weight: bold;">Online Revenue</td>
                    <td style="border: 1px solid #ddd; padding: 8px;">$${onlineSales.toFixed(2)}</td>
                </tr>
                <tr>
                    <td style="border: 1px solid #ddd; padding: 8px; font-weight: bold;">Online Unpaid</td>
                    <td style="border: 1px solid #ddd; padding: 8px; color: red;">$${unpaidOnline.toFixed(2)}</td>
                </tr>
                <tr>
                    <td style="border: 1px solid #ddd; padding: 8px; font-weight: bold;">Total Paid Orders</td>
                    <td style="border: 1px solid #ddd; padding: 8px;">${combinedOrders}</td>
                </tr>
                <tr>
                    <td style="border: 1px solid #ddd; padding: 8px; font-weight: bold;">Total Unpaid Orders</td>
                    <td style="border: 1px solid #ddd; padding: 8px; color: red;">${combinedUnpaidOrders}</td>
                </tr>
                <tr>
                    <td style="border: 1px solid #ddd; padding: 8px; font-weight: bold;">Average Order Value</td>
                    <td style="border: 1px solid #ddd; padding: 8px;">$${avgOrderValue.toFixed(2)}</td>
                </tr>
            </table>
            
            <h2>Top Products</h2>
            <table style="width: 100%; border-collapse: collapse; margin-bottom: 20px;">
                <thead>
                    <tr>
                        <th style="border: 1px solid #ddd; padding: 8px; text-align: left;">Product</th>
                        <th style="border: 1px solid #ddd; padding: 8px; text-align: left;">Quantity Sold</th>
                        <th style="border: 1px solid #ddd; padding: 8px; text-align: left;">Revenue</th>
                        <th style="border: 1px solid #ddd; padding: 8px; text-align: left;">Type</th>
                    </tr>
                </thead>
                <tbody>
        `;
        
        // Combine top products from both restaurant and online
        const allProducts = [];
        
        if (reportData.restaurant.top_products) {
            reportData.restaurant.top_products.forEach(product => {
                allProducts.push({
                    name: product.name,
                    quantity: product.quantity,
                    revenue: product.revenue,
                    type: 'Restaurant'
                });
            });
        }
        
        if (reportData.online.top_products) {
            reportData.online.top_products.forEach(product => {
                const existing = allProducts.find(p => p.name === product.name);
                if (existing) {
                    existing.quantity += product.quantity;
                    existing.revenue += product.revenue;
                } else {
                    allProducts.push({
                        name: product.name,
                        quantity: product.quantity,
                        revenue: product.revenue,
                        type: 'Online'
                    });
                }
            });
        }
        
        // Sort by revenue and take top 10
        const topProducts = allProducts.sort((a, b) => b.revenue - a.revenue).slice(0, 10);
        
        if (topProducts.length > 0) {
            topProducts.forEach(product => {
                htmlContent += `
                    <tr>
                        <td style="border: 1px solid #ddd; padding: 8px;">${product.name || 'Unknown'}</td>
                        <td style="border: 1px solid #ddd; padding: 8px;">${product.quantity || 0}</td>
                        <td style="border: 1px solid #ddd; padding: 8px;">$${(product.revenue || 0).toFixed(2)}</td>
                        <td style="border: 1px solid #ddd; padding: 8px;">${product.type}</td>
                    </tr>
                `;
            });
        } else {
            htmlContent += `
                <tr>
                    <td colspan="4" style="border: 1px solid #ddd; padding: 8px; text-align: center;">
                        No products sold in this period
                    </td>
                </tr>
            `;
        }
        
        htmlContent += `
                </tbody>
            </table>
            
            <p style="text-align: right; font-style: italic;">
                Generated on ${new Date().toLocaleString()}
            </p>
        `;
        
        // Create a new window with the content and print it
        const printWindow = window.open('', '_blank');
        printWindow.document.write(`
            <html>
                <head>
                    <title>Sales Report</title>
                    <style>
                        body { font-family: Arial, sans-serif; margin: 20px; }
                        h1 { color: #333; }
                        h2 { color: #444; margin-top: 20px; }
                        table { width: 100%; border-collapse: collapse; }
                        th { background-color: #f2f2f2; }
                    </style>
                </head>
                <body>
                    ${htmlContent}
                    <script>
                        // Print the document when loaded
                        window.onload = function() {
                            setTimeout(function() {
                                window.print();
                                window.close();
                            }, 200);
                        };
                    <\/script>
                </body>
            </html>
        `);
        printWindow.document.close();
        
        hideLoading();
    }

    // Add week number helper function
    Date.prototype.getWeek = function() {
        const date = new Date(this.getTime());
        date.setHours(0, 0, 0, 0);
        date.setDate(date.getDate() + 3 - (date.getDay() + 6) % 7);
        const week1 = new Date(date.getFullYear(), 0, 4);
        return 1 + Math.round(((date.getTime() - week1.getTime()) / 86400000 - 3 + (week1.getDay() + 6) % 7) / 7);
    };

    // Add the online order functions
    function loadOnlineOrders(status = 'all', date = '', search = '', paymentStatus = '') {
        showLoading();
        
        $.ajax({
            url: '/api/online/orders',
            method: 'GET',
            data: {
                status: status === 'all' ? '' : status,
                date: date,
                search: search,
                payment_status: paymentStatus
            },
            success: function(response) {
                const tbody = $('#online-orders-table-body');
                tbody.empty();
                
                if (response && response.length > 0) {
                    response.forEach(order => {
                        const itemsCount = order.items ? order.items.length : 0;
                        let statusBadge;
                        
                        switch(order.status) {
                            case 'pending':
                                statusBadge = '<span class="badge badge-warning">Pending</span>';
                                break;
                            case 'processing':
                                statusBadge = '<span class="badge badge-info">Processing</span>';
                                break;
                            case 'completed':
                                statusBadge = '<span class="badge badge-success">Completed</span>';
                                break;
                            case 'cancelled':
                                statusBadge = '<span class="badge badge-danger">Cancelled</span>';
                                break;
                            default:
                                statusBadge = '<span class="badge badge-secondary">Unknown</span>';
                        }
                        
                        let paymentBadge = order.payment_status === 'paid' ? 
                            '<span class="badge badge-success">Paid</span>' : 
                            '<span class="badge badge-danger">Unpaid</span>';
                        
                        tbody.append(`
                            <tr>
                                <td>${order.order_number}</td>
                                <td>${order.customer_name}</td>
                                <td>${itemsCount} items</td>
                                <td>$${order.total.toFixed(2)}</td>
                                <td>${paymentBadge}</td>
                                <td>${statusBadge}</td>
                                <td>${new Date(order.created_at).toLocaleDateString()}</td>
                                <td>
                                    <button class="btn btn-info btn-sm view-online-order-btn" data-id="${order.id}">
                                        <i class="fas fa-eye"></i>
                                    </button>
                                    <button class="btn btn-primary btn-sm update-online-order-btn" data-id="${order.id}">
                                        <i class="fas fa-edit"></i>
                                    </button>
                                    <button class="btn btn-danger btn-sm delete-online-order-btn" 
                                            data-id="${order.id}" 
                                            data-order-number="${order.order_number}">
                                        <i class="fas fa-trash"></i>
                                    </button>
                                </td>
                            </tr>
                        `);
                    });
                } else {
                    tbody.append(`
                        <tr>
                            <td colspan="8" class="text-center">No online orders found</td>
                        </tr>
                    `);
                }
                
                initOnlineOrdersDataTable();
            },
            error: function(xhr) {
                handleAjaxError(xhr, 'Failed to load online orders');
            },
            complete: function() {
                hideLoading();
            }
        });
    }

    function initOnlineOrdersDataTable() {
        if ($.fn.DataTable.isDataTable('#online-orders-table')) {
            $('#online-orders-table').DataTable().destroy();
        }
        
        $('#online-orders-table').DataTable({
            responsive: true,
            destroy: true,
            pageLength: 10,
            lengthMenu: [[10, 25, 50, 100, -1], [10, 25, 50, 100, "All"]],
            dom: '<"top"lf>rt<"bottom"ip>',
            language: {
                search: "_INPUT_",
                searchPlaceholder: "Search...",
                lengthMenu: "Show _MENU_ entries",
                info: "Showing _START_ to _END_ of _TOTAL_ entries",
                infoEmpty: "Showing 0 to 0 of 0 entries",
                infoFiltered: "(filtered from _MAX_ total entries)",
                paginate: {
                    first: "First",
                    last: "Last",
                    next: "Next",
                    previous: "Previous"
                }
            }
        });
    }

    // Initialize filters when page loads
    function initOnlineOrdersFilters() {
        // Set default date to today
        const today = new Date().toISOString().split('T')[0];
        $('#online-orders-date').val(today);
        
        // Load initial data with default filters
        loadOnlineOrders('all', today, '');
        
        // Add event listeners for filter changes
        $('#online-orders-date').change(function() {
            const activeTab = $('#online-orders-content .section-tab.active').data('tab');
            loadOnlineOrders(activeTab, $(this).val(), '');
        });
        
        // Apply filters button
        $('#apply-online-order-filters-btn').click(function() {
            const activeTab = $('#online-orders-content .section-tab.active').data('tab');
            loadOnlineOrders(activeTab, $('#online-orders-date').val(), '');
        });
        
        // Section tabs click handler
        $(document).on('click', '#online-orders-content .section-tab', function() {
            const tab = $(this).data('tab');
            $('#online-orders-content .section-tab').removeClass('active');
            $(this).addClass('active');
            loadOnlineOrders(tab, $('#online-orders-date').val(), '');
        });
    }

    function loadOnlineOrders(status = 'all', date = '', search = '') {
        showLoading();
        
        $.ajax({
            url: '/api/online/orders',
            method: 'GET',
            data: {
                status: status === 'all' ? '' : status,
                date: date,
                search: search
            },
            success: function(response) {
                const tbody = $('#online-orders-table-body');
                tbody.empty();
                
                if (response && response.length > 0) {
                    response.forEach(order => {
                        const itemsCount = order.items ? order.items.length : 0;
                        let statusBadge;
                        
                        switch(order.status) {
                            case 'pending':
                                statusBadge = '<span class="badge badge-warning">Pending</span>';
                                break;
                            case 'processing':
                                statusBadge = '<span class="badge badge-info">Processing</span>';
                                break;
                            case 'completed':
                                statusBadge = '<span class="badge badge-success">Completed</span>';
                                break;
                            case 'cancelled':
                                statusBadge = '<span class="badge badge-danger">Cancelled</span>';
                                break;
                            default:
                                statusBadge = '<span class="badge badge-secondary">Unknown</span>';
                        }
                        
                        tbody.append(`
                            <tr>
                                <td>${order.order_number}</td>
                                <td>${order.customer_name}</td>
                                <td>${itemsCount} items</td>
                                <td>$${order.total.toFixed(2)}</td>
                                <td>${order.payment_method}</td>
                                <td>${statusBadge}</td>
                                <td>${new Date(order.created_at).toLocaleDateString()}</td>
                                <td>
                                    <button class="btn btn-info btn-sm view-online-order-btn" data-id="${order.id}">
                                        <i class="fas fa-eye"></i>
                                    </button>
                                    <button class="btn btn-primary btn-sm update-online-order-btn" data-id="${order.id}">
                                        <i class="fas fa-edit"></i>
                                    </button>
                                    <button class="btn btn-danger btn-sm delete-online-order-btn" 
                                            data-id="${order.id}" 
                                            data-order-number="${order.order_number}">
                                        <i class="fas fa-trash"></i>
                                    </button>
                                </td>
                            </tr>
                        `);
                    });
                } else {
                    tbody.append(`
                        <tr>
                            <td colspan="8" class="text-center">No online orders found</td>
                        </tr>
                    `);
                }
                
                // Initialize or reinitialize DataTable
                if ($.fn.DataTable.isDataTable('#online-orders-table')) {
                    $('#online-orders-table').DataTable().destroy();
                }
                
                $('#online-orders-table').DataTable({
                    responsive: true,
                    destroy: true,
                    pageLength: 10,
                    lengthMenu: [[10, 25, 50, 100, -1], [10, 25, 50, 100, "All"]],
                    dom: '<"top"lf>rt<"bottom"ip>',
                    language: {
                        search: "_INPUT_",
                        searchPlaceholder: "Search...",
                        lengthMenu: "Show _MENU_ entries",
                        info: "Showing _START_ to _END_ of _TOTAL_ entries",
                        infoEmpty: "Showing 0 to 0 of 0 entries",
                        infoFiltered: "(filtered from _MAX_ total entries)",
                        paginate: {
                            first: "First",
                            last: "Last",
                            next: "Next",
                            previous: "Previous"
                        }
                    }
                });
            },
            error: function(xhr) {
                handleAjaxError(xhr, 'Failed to load online orders');
            },
            complete: function() {
                hideLoading();
            }
        });
    }

    function updateOnlineOrderStatus(orderId) {
        $.ajax({
            url: `/api/online/orders/${orderId}`,
            method: 'GET',
            success: function(response) {
                const modalHtml = `
                    <div class="modal" id="update-online-order-modal">
                        <div class="modal-dialog">
                            <div class="modal-content">
                                <div class="modal-header">
                                    <h5 class="modal-title">Update Order #${response.order_number}</h5>
                                    <button type="button" class="close" data-dismiss="modal">&times;</button>
                                </div>
                                <div class="modal-body">
                                    <form id="update-online-order-form">
                                        <div class="form-group">
                                            <label for="online-order-status">Status</label>
                                            <select class="form-control" id="online-order-status">
                                                <option value="pending" ${response.status === 'pending' ? 'selected' : ''}>Pending</option>
                                                <option value="processing" ${response.status === 'processing' ? 'selected' : ''}>Processing</option>
                                                <option value="completed" ${response.status === 'completed' ? 'selected' : ''}>Completed</option>
                                                <option value="cancelled" ${response.status === 'cancelled' ? 'selected' : ''}>Cancelled</option>
                                            </select>
                                        </div>
                                        <div class="form-group">
                                            <label for="online-order-notes">Notes</label>
                                            <textarea class="form-control" id="online-order-notes" rows="3">${response.notes || ''}</textarea>
                                        </div>
                                    </form>
                                </div>
                                <div class="modal-footer">
                                    <button type="button" class="btn btn-secondary" data-dismiss="modal">Cancel</button>
                                    <button type="button" class="btn btn-primary" id="save-online-order-btn">Save Changes</button>
                                </div>
                            </div>
                        </div>
                    </div>
                `;
                
                $('body').append(modalHtml);
                $('#update-online-order-modal').modal('show');
                
                // Save button handler
                $('#save-online-order-btn').click(function() {
                    const data = {
                        status: $('#online-order-status').val(),
                        notes: $('#online-order-notes').val()
                    };
                    
                    $.ajax({
                        url: `/api/online/orders/${orderId}`,
                        method: 'PUT',
                        contentType: 'application/json',
                        data: JSON.stringify(data),
                        success: function(response) {
                            $('#update-online-order-modal').modal('hide');
                            showAlert('success', 'Order updated successfully');
                            loadOnlineOrders();
                        },
                        error: function(xhr) {
                            handleAjaxError(xhr, 'Failed to update order');
                        }
                    });
                });
                
                // Remove modal when closed
                $('#update-online-order-modal').on('hidden.bs.modal', function() {
                    $(this).remove();
                });
            },
            error: function(xhr) {
                handleAjaxError(xhr, 'Failed to load order details');
            }
        });
    }

    function deleteOnlineOrder(orderId) {
        if (!confirm('Are you sure you want to delete this order? This cannot be undone.')) {
            return;
        }

        showLoading();
        
        $.ajax({
            url: `/api/online/orders/${orderId}`,
            method: 'DELETE',
            success: function(response) {
                showAlert('success', response.message);
                // Reload the orders after deletion
                const activeTab = $('#online-orders-content .section-tab.active').data('tab');
                loadOnlineOrders(activeTab, $('#online-orders-date').val(), '');
            },
            error: function(xhr) {
                handleAjaxError(xhr, 'Failed to delete online order');
            },
            complete: function() {
                hideLoading();
            }
        });
    }

    function logout() {
        $.ajax({
            url: '/logout',
            method: 'GET',
            success: function() {
                window.location.href = '/login';
            },
            error: function(xhr) {
                handleAjaxError(xhr, 'Failed to logout');
            }
        });
    }

    // Handle browser back/forward buttons
    window.addEventListener('popstate', showPageFromURL);
</script>